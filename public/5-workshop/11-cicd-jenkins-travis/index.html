<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.149.0">
    <meta name="description" content="AWS MLOps Retail Prediction Platform Documentation">
<meta name="author" content="Nguy·ªÖn Thanh Nh√¢n &amp; H√† Kh·∫£ Nguy√™n">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>CI/CD Pipeline :: AWS MLOps Docs</title>

    
    <link href="/css/nucleus.css?1765385195" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1765385195" rel="stylesheet">
    <link href="/css/hybrid.css?1765385195" rel="stylesheet">
    <link href="/css/featherlight.min.css?1765385195" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1765385195" rel="stylesheet">
    <link href="/css/auto-complete.css?1765385195" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1765385195" rel="stylesheet">
    <link href="/css/theme.css?1765385195" rel="stylesheet">
    <link href="/css/hugo-theme.css?1765385195" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1765385195" rel="stylesheet">
    
    <link href="/css/custom-image-border.css?1765385195" rel="stylesheet">

    <script src="/js/jquery-3.3.1.min.js?1765385195"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <style type="text/css">
 
.content figure img, .content p img, img.bordered-image {
  border: 2px solid black !important;
  padding: 5px !important;
  margin: 10px auto !important;
  display: block !important;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3) !important;
}

 
img {
  margin: 10px auto !important;
  display: block !important;
}

 
figure {
  text-align: center !important;
  margin: 10px auto !important;
}

 
.content figure figcaption {
  text-align: center;
  font-style: italic;
  margin-top: 5px;
  font-weight: bold;
}

 
.content p img {
  margin: 10px auto !important;
  display: block !important;
}

 
.content p {
  text-align: center;
}

.content p:not(:has(img)) {
  text-align: left;
}
</style>

  </head>
  <body class="" data-url="/5-workshop/11-cicd-jenkins-travis/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1765385195"></script>
<script type="text/javascript" src="/js/auto-complete.js?1765385195"></script>
<script type="text/javascript">
    var baseurl = "http:\/\/localhost:1313\/";
</script>
<script type="text/javascript" src="/js/search.js?1765385195"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">
        
          
          




 
  
    
    <li data-nav-id="/1-worklog/" title="Worklog" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/">
           <b> 1. </b> Worklog
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.1-week1/" title="Week 1 - Introduction to AWS" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.1-week1/">
           <b> 1.1. </b> Week 1 - Introduction to AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.2-week2/" title="Week 2 - Networking on AWS" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.2-week2/">
           <b> 1.2. </b> Week 2 - Networking on AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.3-week3/" title="Week 3 - Compute VM Service on AWS" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.3-week3/">
           <b> 1.3. </b> Week 3 - Compute VM Service on AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.4-week4/" title="Week 4 - Storage Service on AWS" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.4-week4/">
           <b> 1.4. </b> Week 4 - Storage Service on AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.5-week5/" title="Week 5 - Security Services on AWS" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.5-week5/">
           <b> 1.5. </b> Week 5 - Security Services on AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.6-week6/" title="Week 6 - Database Service on AWS" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.6-week6/">
           <b> 1.6. </b> Week 6 - Database Service on AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.7-week7/" title="Week 7 - DataLake Service on AWS" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.7-week7/">
           <b> 1.7. </b> Week 7 - DataLake Service on AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.8-week8/" title="Week 8 - Serverless Compute" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.8-week8/">
           <b> 1.8. </b> Week 8 - Serverless Compute
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.9-week9/" title="Week 9 - Container Compute" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.9-week9/">
           <b> 1.9. </b> Week 9 - Container Compute
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.10-week10/" title="Week 10 - DevOps &amp; IaC" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.10-week10/">
           <b> 1.10. </b> Week 10 - DevOps &amp; IaC
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.11-week11/" title="Week 11 - Observability &amp; FinOps" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.11-week11/">
           <b> 1.11. </b> Week 11 - Observability &amp; FinOps
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-worklog/1.12-week12/" title="Week 12 - Capstone: Personal Project" class="dd-item 
        
        
        
        ">
      <a href="/1-worklog/1.12-week12/">
           <b> 1.12. </b> Week 12 - Capstone: Personal Project
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-proposal/" title="Proposal" class="dd-item 
        
        
        
        ">
      <a href="/2-proposal/">
           <b> 2. </b> Proposal
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-blogstranslated/" title="Translated blogs" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/">
           <b> 3. </b> Translated blogs
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.1-blog1/" title="C√¥ng b·ªë c√°c ƒê·ªëi t√°c AWS c·ªßa NƒÉm 2025 khu v·ª±c ch√¢u √Çu, Trung ƒê√¥ng v√† ch√¢u Phi" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.1-blog1/">
           <b> 3.1. </b> C√¥ng b·ªë c√°c ƒê·ªëi t√°c AWS c·ªßa NƒÉm 2025 khu v·ª±c ch√¢u √Çu, Trung ƒê√¥ng v√† ch√¢u Phi
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.2-blog2/" title="C√°ch t√πy ch·ªânh ph·∫£n h·ªìi ƒë·ªëi v·ªõi c√°c cu·ªôc t·∫•n c√¥ng DDoS t·∫ßng 7 b·∫±ng AWS WAF Anti-DDoS AMR" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.2-blog2/">
           <b> 3.2. </b> C√°ch t√πy ch·ªânh ph·∫£n h·ªìi ƒë·ªëi v·ªõi c√°c cu·ªôc t·∫•n c√¥ng DDoS t·∫ßng 7 b·∫±ng AWS WAF Anti-DDoS AMR
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.3-blog3/" title="AWS Marketplace: Ch·∫•t x√∫c t√°c cho vi·ªác hi·ªán ƒë·∫°i h√≥a mua s·∫Øm li√™n bang" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.3-blog3/">
           <b> 3.3. </b> AWS Marketplace: Ch·∫•t x√∫c t√°c cho vi·ªác hi·ªán ƒë·∫°i h√≥a mua s·∫Øm li√™n bang
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.4-blog4/" title="T√≠ch h·ª£p d·ªØ li·ªáu S&amp;P Global m·ªü r·ªông kh·∫£ nƒÉng Amazon QuickSight Research" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.4-blog4/">
           <b> 3.4. </b> T√≠ch h·ª£p d·ªØ li·ªáu S&amp;P Global m·ªü r·ªông kh·∫£ nƒÉng Amazon QuickSight Research
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.5-blog5/" title="C√°ch VƒÉn ph√≤ng T·ªïng ch∆∞·ªüng l√Ω Qu·∫≠n Contra Costa hi·ªán ƒë·∫°i h√≥a quy tr√¨nh x·ª≠ l√Ω tr√°t ƒë√≤i h·∫ßu t√≤a v·ªõi AWS v√† CC Tech Digital" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.5-blog5/">
           <b> 3.5. </b> C√°ch VƒÉn ph√≤ng T·ªïng ch∆∞·ªüng l√Ω Qu·∫≠n Contra Costa hi·ªán ƒë·∫°i h√≥a quy tr√¨nh x·ª≠ l√Ω tr√°t ƒë√≤i h·∫ßu t√≤a v·ªõi AWS v√† CC Tech Digital
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.6-blog6/" title="H·ª£p l√Ω h√≥a s·ª± h·ª£p t√°c gi·ªØa c√°c S·ªü Giao th√¥ng V·∫≠n t·∫£i v·ªõi Private Blockchain" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.6-blog6/">
           <b> 3.6. </b> H·ª£p l√Ω h√≥a s·ª± h·ª£p t√°c gi·ªØa c√°c S·ªü Giao th√¥ng V·∫≠n t·∫£i v·ªõi Private Blockchain
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.7-blog7/" title="Introducing the AWS Infrastructure as Code MCP Server: AI-Powered CDK and CloudFormation Assistance" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.7-blog7/">
           <b> 3.7. </b> Introducing the AWS Infrastructure as Code MCP Server: AI-Powered CDK and CloudFormation Assistance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.8-blog8/" title="AWS Clean Rooms launches privacy-enhancing synthetic dataset generation for ML model training" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.8-blog8/">
           <b> 3.8. </b> AWS Clean Rooms launches privacy-enhancing synthetic dataset generation for ML model training
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.9-blog9/" title="AWS Partner Central now available in AWS Management Console" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.9-blog9/">
           <b> 3.9. </b> AWS Partner Central now available in AWS Management Console
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.10-blog10/" title="Announcing AWS Partner Central in the AWS Management Console" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.10-blog10/">
           <b> 3.10. </b> Announcing AWS Partner Central in the AWS Management Console
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.11-blog11/" title="Announcing Amazon EKS Capabilities for workload orchestration and cloud resource management" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.11-blog11/">
           <b> 3.11. </b> Announcing Amazon EKS Capabilities for workload orchestration and cloud resource management
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-blogstranslated/3.12-blog12/" title="Simplify IAM policy creation with IAM Policy Autopilot, a new open source MCP server for builders" class="dd-item 
        
        
        
        ">
      <a href="/3-blogstranslated/3.12-blog12/">
           <b> 3.12. </b> Simplify IAM policy creation with IAM Policy Autopilot, a new open source MCP server for builders
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-eventparticipated/" title="Events Participated" class="dd-item 
        
        
        
        ">
      <a href="/4-eventparticipated/">
           <b> 4. </b> Events Participated
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-workshop/" title="Workshop" class="dd-item 
        parent
        
        
        ">
      <a href="/5-workshop/">
          <b>5. </b>Workshop
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/1-introduction/" title="MLOps Architecture Design" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/1-introduction/">
          <b>1. </b>MLOps Architecture Design
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/2-iam-roles-audit/" title="IAM Roles &amp; Audit For MLops" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/2-iam-roles-audit/">
          <b>2. </b>IAM Roles &amp; Audit For MLops
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/3-s3-data-storage/" title="Data Pipeline Optimization" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/3-s3-data-storage/">
          <b>3. </b>Data Pipeline Optimization
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/4-sagemaker-training/" title="End-to-End Model Training Pipeline" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/4-sagemaker-training/">
          <b>4. </b>End-to-End Model Training Pipeline
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/5-vpc/" title="Production Networking" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/5-vpc/">
          <b>5. </b>Production Networking
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/6-ecr-registry/" title="Amazon ECR Container Registry (MLOps)" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/6-ecr-registry/">
          <b>6. </b>Amazon ECR Container Registry (MLOps)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/7-eks-cluster/" title="EKS Cluster Setup (Production)" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/7-eks-cluster/">
          <b>7. </b>EKS Cluster Setup (Production)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/8-deploy-kubernetes/" title="API Deployment on EKS" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/8-deploy-kubernetes/">
          <b>8. </b>API Deployment on EKS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/9-elastic-load-balancing/" title="Load Balancing" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/9-elastic-load-balancing/">
          <b>9. </b>Load Balancing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/10-cloudwatch/" title="CloudWatch Monitoring" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/10-cloudwatch/">
          <b>10. </b>CloudWatch Monitoring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/11-cicd-jenkins-travis/" title="CI/CD Pipeline" class="dd-item 
        
        active
        
        ">
      <a href="/5-workshop/11-cicd-jenkins-travis/">
          <b>11. </b>CI/CD Pipeline
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-workshop/12-cost--teardown/" title="Cost Management &amp; Teardown" class="dd-item 
        
        
        
        ">
      <a href="/5-workshop/12-cost--teardown/">
          <b>12. </b>Cost Management &amp; Teardown
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-self-evaluation/" title="Self-Assessment" class="dd-item 
        
        
        
        ">
      <a href="/6-self-evaluation/">
           <b> 6. </b> Self-Assessment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-feedback/" title="Sharing and Feedback" class="dd-item 
        
        
        
        ">
      <a href="/7-feedback/">
           <b> 7. </b> Sharing and Feedback
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="workshop-stats" style="padding: 8px; margin-top: 15px;">
      <div style="background-color: var(--MENU-SECTIONS-BG-color); padding: 8px; border-radius: 6px; margin-bottom: 8px;">
        
        <div style="text-align: center; margin-bottom: 8px;">
          <b style="color: #fd9827; font-size: 12px;">üìä Workshop Stats</b> <br>
          <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Workshop Views" Alt="workshop counter" border="0" style="margin: 2px 0;" />
        </div>
        
        
        <div style="text-align: center; margin-bottom: 8px;">
          <b style="color: #4881cd; font-size: 12px;"><a href="https://cloudjourney.awsstudygroup.com/" style="color: #4881cd; text-decoration: none;">üå•Ô∏è Cloud Journey</a></b> <br>
          <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Cloud Journey Views" Alt="cloud journey counter" border="0" style="margin: 2px 0;" />
        </div>

        
        <div style="text-align: center; border-top: 1px solid var(--MENU-SECTION-HR-color); padding-top: 12px; margin-top: 12px;">
          
          <div style="margin-bottom: 8px;">
            <div style="color: #fd9827; font-weight: bold; font-size: 13px; margin-bottom: 3px;">üìÖ Last Updated</div>
            <div style="color: #ffa500; font-style: italic; font-size: 13px;">28-09-2025</div>
          </div>
          
          
          <div>
            <div style="color: #fd9827; font-weight: bold; font-size: 13px; margin-bottom: 5px;">Team</div>
            <div style="line-height: 1.2;">
              <div style="margin-bottom: 2px;">
                <a href="https://www.linkedin.com/in/nguyen-nhan-732a66247" style="color: #4881cd; text-decoration: none; font-size: 13px;">Nguy·ªÖn Thanh Nh√¢n</a>
              </div>
              <div>
                <span style="color: #4881cd; font-size: 13px;">H√† Kh·∫£ Nguy√™n</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://localhost:1313/5-workshop/11-cicd-jenkins-travis/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://localhost:1313/vi/5-workshop/11-cicd-jenkins-travis/">Ti·∫øng Vi·ªát</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      
<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>


 
        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/uit-ntn/aws-mlops-retail-forecast/edit/main/content/5-Workshop/11-cicd-jenkins-travis/_index.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Internship Report</a> > <a href='/5-workshop/'>Workshop</a> > CI/CD Pipeline
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#1-overall-pipeline-structure">1. Overall Pipeline Structure</a>
      <ul>
        <li><a href="#2-iam-roles-v√†-permissions">2. IAM Roles v√† Permissions</a></li>
        <li><a href="#3-jenkins-pipeline-setup">3. Jenkins Pipeline Setup</a></li>
      </ul>
    </li>
    <li><a href="#2-github-actions-cicd-pipeline">2. GitHub Actions CI/CD Pipeline</a>
      <ul>
        <li><a href="#21-c·∫•u-h√¨nh-workflow-file">2.1 C·∫•u h√¨nh workflow file</a></li>
      </ul>
    </li>
    <li><a href="#3-iam-role-v√†-quy·ªÅn-h·∫°n">3. IAM Role v√† Quy·ªÅn h·∫°n</a>
      <ul>
        <li><a href="#31-t·∫°o-iam-role-cho-github-actions">3.1 T·∫°o IAM Role cho GitHub Actions</a></li>
        <li><a href="#32-iam-policy-cho-cicd-pipeline">3.2 IAM Policy cho CI/CD Pipeline</a></li>
        <li><a href="#33-g·∫Øn-policy-cho-role">3.3 G·∫Øn Policy cho Role</a></li>
      </ul>
    </li>
    <li><a href="#4-script-h·ªó-tr·ª£-cho-pipeline">4. Script h·ªó tr·ª£ cho Pipeline</a>
      <ul>
        <li><a href="#41-script-t·∫°o-training-job">4.1 Script t·∫°o Training Job</a></li>
        <li><a href="#42-script-ƒë√°nh-gi√°-model">4.2 Script ƒë√°nh gi√° Model</a></li>
        <li><a href="#43-script-ƒëƒÉng-k√Ω-model-registry">4.3 Script ƒëƒÉng k√Ω Model Registry</a></li>
        <li><a href="#44-script-tri·ªÉn-khai-endpoint">4.4 Script tri·ªÉn khai Endpoint</a></li>
        <li><a href="#45-script-ki·ªÉm-tra-hi·ªáu-su·∫•t-endpoint">4.5 Script ki·ªÉm tra hi·ªáu su·∫•t Endpoint</a></li>
      </ul>
    </li>
    <li><a href="#5-gi√°m-s√°t-v√†-th√¥ng-b√°o">5. Gi√°m s√°t v√† Th√¥ng b√°o</a>
      <ul>
        <li><a href="#51-thi·∫øt-l·∫≠p-sns-topic">5.1 Thi·∫øt l·∫≠p SNS Topic</a></li>
        <li><a href="#52-cloudwatch-dashboard-cho-cicd-pipeline">5.2 CloudWatch Dashboard cho CI/CD Pipeline</a></li>
        <li><a href="#53-c·∫•u-h√¨nh-pipeline-metrics">5.3 C·∫•u h√¨nh Pipeline Metrics</a></li>
      </ul>
    </li>
    <li><a href="#6-ki·ªÉm-tra-v√†-x√°c-th·ª±c">6. Ki·ªÉm tra v√† X√°c th·ª±c</a>
      <ul>
        <li><a href="#61-checklist-ho√†n-th√†nh">6.1 Checklist Ho√†n th√†nh</a></li>
        <li><a href="#62-pipeline-testing">6.2 Pipeline Testing</a></li>
        <li><a href="#63-monitoring-commands">6.3 Monitoring Commands</a></li>
      </ul>
    </li>
    <li><a href="#7-best-practices--t·ªëi-∆∞u">7. Best Practices &amp; T·ªëi ∆∞u</a>
      <ul>
        <li><a href="#71-pipeline-optimization">7.1 Pipeline Optimization</a></li>
        <li><a href="#72-security-best-practices">7.2 Security Best Practices</a></li>
        <li><a href="#73-quality-gates">7.3 Quality Gates</a></li>
        <li><a href="#74-observability">7.4 Observability</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#8-clean-up-cicd-resources">8. Clean Up CI/CD Resources</a>
      <ul>
        <li><a href="#81-x√≥a-github-actions-workflow">8.1 X√≥a GitHub Actions Workflow</a></li>
        <li><a href="#82-x√≥a-iam-roles-v√†-policies">8.2 X√≥a IAM Roles v√† Policies</a></li>
        <li><a href="#83-x√≥a-jenkins-infrastructure-n·∫øu-s·ª≠-d·ª•ng">8.3 X√≥a Jenkins Infrastructure (n·∫øu s·ª≠ d·ª•ng)</a></li>
        <li><a href="#84-x√≥a-sns-topics-v√†-subscriptions">8.4 X√≥a SNS Topics v√† Subscriptions</a></li>
        <li><a href="#85-x√≥a-cloudwatch-resources-cho-cicd">8.5 X√≥a CloudWatch Resources cho CI/CD</a></li>
        <li><a href="#86-x√≥a-ecr-images-v√†-tags">8.6 X√≥a ECR Images v√† Tags</a></li>
        <li><a href="#87-clean-up-sagemaker-resources">8.7 Clean Up SageMaker Resources</a></li>
        <li><a href="#88-verification">8.8 Verification</a></li>
      </ul>
    </li>
    <li><a href="#9-b·∫£ng-gi√°-cicd-pipeline-ap-southeast-1">9. B·∫£ng gi√° CI/CD Pipeline (ap-southeast-1)</a>
      <ul>
        <li><a href="#91-github-actions-pricing">9.1. GitHub Actions Pricing</a></li>
        <li><a href="#92-aws-iam-v√†-security-costs">9.2. AWS IAM v√† Security Costs</a></li>
        <li><a href="#93-sagemaker-training-costs-trong-cicd">9.3. SageMaker Training Costs trong CI/CD</a></li>
        <li><a href="#94-ecr-storage-v√†-transfer-costs">9.4. ECR Storage v√† Transfer Costs</a></li>
        <li><a href="#95-cloudwatch-monitoring-cho-cicd">9.5. CloudWatch Monitoring cho CI/CD</a></li>
        <li><a href="#96-sns-notification-costs">9.6. SNS Notification Costs</a></li>
        <li><a href="#97-jenkins-infrastructure-costs-n·∫øu-self-hosted">9.7. Jenkins Infrastructure Costs (n·∫øu self-hosted)</a></li>
        <li><a href="#98-cicd-pipeline-scenarios">9.8. CI/CD Pipeline Scenarios</a></li>
        <li><a href="#99-cost-optimization-strategies">9.9. Cost Optimization Strategies</a></li>
        <li><a href="#910-roi-analysis-cho-cicd-investment">9.10. ROI Analysis cho CI/CD Investment</a></li>
        <li><a href="#911-monitoring-cicd-costs">9.11. Monitoring CI/CD Costs</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              CI/CD Pipeline
            </h1>
          

        



	
<div class="notices info" ><p><strong>üéØ Task 13 Objective:</strong></p>
</div>

<p>Set up an automated CI/CD pipeline for the entire MLOps Retail Prediction project lifecycle:</p>
<ul>
<li>CI (Continuous Integration): build &amp; test code, build Docker image, push to ECR</li>
<li>CD (Continuous Delivery): retrain model when needed, update Model Registry, deploy new versions to EKS</li>
<li>Monitoring hooks: automated rollback on API or model failures (CloudWatch triggers)</li>
</ul>
<p>‚Üí Ensure continuous delivery, reduce manual errors, and save time and cost.</p>
<p>üì• <strong>Input from previous Tasks:</strong></p>
<ul>
<li><strong>Task 6 (ECR Container Registry):</strong> Repository URIs, lifecycle policies, image scanning and push commands; credentials and ECR access for CI runners</li>
<li><strong>Task 8 (API Deployment on EKS):</strong> Kubernetes manifests, service &amp; deployment names, healthcheck endpoints, HPA and ServiceAccount/IRSA details used by CD stage</li>
<li><strong>Task 10 (CloudWatch Monitoring):</strong> Log groups, alarms, dashboards and Container Insights configuration used for deployment verification and automated rollback triggers</li>
<li><strong>Task 2 (IAM Roles &amp; Audit):</strong> IAM roles, OIDC provider configuration and least-privilege policies for CI/CD runners (GitHub Actions / Jenkins) and SageMaker execution</li>
</ul>
<h2 id="1-overall-pipeline-structure">1. Overall Pipeline Structure</h2>
<p>The Retail Prediction CI/CD pipeline automates the full process from code commits to production deployment, including retraining models when necessary.</p>
<p>The pipeline is divided into three environments:</p>
<ul>
<li><strong>DEV</strong>: Build, test and validate code</li>
<li><strong>STAGING</strong>: Train and evaluate models</li>
<li><strong>PROD</strong>: Deploy and monitor in production</li>
</ul>
<h3 id="2-iam-roles-v√†-permissions">2. IAM Roles v√† Permissions</h3>
<h4 id="21-create-cicd-service-role">2.1 Create CI/CD Service Role</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Create trust policy for CI/CD role</span>
</span></span><span style="display:flex;"><span>cat &gt; cicd-trust-policy.json <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Statement&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Principal&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;Service&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;ec2.amazonaws.com&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;codebuild.amazonaws.com&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;codepipeline.amazonaws.com&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Action&#34;: &#34;sts:AssumeRole&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Principal&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;AWS&#34;: &#34;arn:aws:iam::YOUR_ACCOUNT_ID:user/jenkins-user&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Action&#34;: &#34;sts:AssumeRole&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create the role</span>
</span></span><span style="display:flex;"><span>aws iam create-role <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name RetailForecastCICDRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --assume-role-policy-document file://cicd-trust-policy.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --description <span style="color:#e6db74">&#34;Role for Retail Forecast CI/CD Pipeline&#34;</span>
</span></span></code></pre></div><h4 id="22-cicd-iam-policy">2.2 CI/CD IAM Policy</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;s3:GetObject&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;s3:PutObject&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;s3:DeleteObject&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;s3:ListBucket&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:s3:::retail-forecast-data-bucket&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:s3:::retail-forecast-data-bucket/*&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:s3:::retail-forecast-artifacts-bucket&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:s3:::retail-forecast-artifacts-bucket/*&#34;</span>
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:GetAuthorizationToken&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:BatchCheckLayerAvailability&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:GetDownloadUrlForLayer&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:BatchGetImage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:PutImage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:InitiateLayerUpload&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:UploadLayerPart&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:CompleteLayerUpload&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateTrainingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeTrainingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:StopTrainingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateModel&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateModelPackage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateModelPackageGroup&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeModelPackage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:UpdateModelPackage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:ListModelPackages&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;eks:DescribeCluster&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;eks:ListClusters&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;eks:DescribeNodegroup&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [<span style="color:#e6db74">&#34;sts:GetCallerIdentity&#34;</span>, <span style="color:#e6db74">&#34;sts:AssumeRole&#34;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [<span style="color:#e6db74">&#34;kms:Decrypt&#34;</span>, <span style="color:#e6db74">&#34;kms:GenerateDataKey&#34;</span>, <span style="color:#e6db74">&#34;kms:CreateGrant&#34;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: [<span style="color:#e6db74">&#34;arn:aws:kms:us-east-1:YOUR_ACCOUNT_ID:key/*&#34;</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:CreateLogGroup&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:CreateLogStream&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:PutLogEvents&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="23-attach-policies">2.3 Attach Policies</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Create and attach the policy</span>
</span></span><span style="display:flex;"><span>aws iam create-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-name RetailForecastCICDPolicy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-document file://cicd-policy.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam attach-role-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name RetailForecastCICDRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::YOUR_ACCOUNT_ID:policy/RetailForecastCICDPolicy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Attach additional managed policies</span>
</span></span><span style="display:flex;"><span>aws iam attach-role-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name RetailForecastCICDRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::aws:policy/AmazonEKSClusterPolicy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam attach-role-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name RetailForecastCICDRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy
</span></span></code></pre></div><h3 id="3-jenkins-pipeline-setup">3. Jenkins Pipeline Setup</h3>
<h4 id="31-jenkins-installation-on-ec2">3.1 Jenkins Installation on EC2</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Launch EC2 instance for Jenkins</span>
</span></span><span style="display:flex;"><span>aws ec2 run-instances <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image-id ami-0c55b159cbfafe1d0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --instance-type t3.medium <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --key-name your-key-pair <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --security-group-ids sg-jenkins <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --subnet-id subnet-12345678 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --iam-instance-profile Name<span style="color:#f92672">=</span>JenkinsInstanceProfile <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --user-data file://jenkins-install.sh <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --tag-specifications <span style="color:#e6db74">&#39;ResourceType=instance,Tags=[{Key=Name,Value=Jenkins-Server},{Key=Project,Value=RetailForecast}]&#39;</span>
</span></span></code></pre></div><h4 id="32-jenkins-installation-script">3.2 Jenkins Installation Script</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># jenkins-install.sh</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update system</span>
</span></span><span style="display:flex;"><span>yum update -y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install Docker</span>
</span></span><span style="display:flex;"><span>yum install -y docker
</span></span><span style="display:flex;"><span>systemctl start docker
</span></span><span style="display:flex;"><span>systemctl enable docker
</span></span><span style="display:flex;"><span>usermod -a -G docker ec2-user
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install Docker Compose</span>
</span></span><span style="display:flex;"><span>curl -L <span style="color:#e6db74">&#34;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-</span><span style="color:#66d9ef">$(</span>uname -s<span style="color:#66d9ef">)</span><span style="color:#e6db74">-</span><span style="color:#66d9ef">$(</span>uname -m<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>chmod +x /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install Jenkins</span>
</span></span><span style="display:flex;"><span>wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
</span></span><span style="display:flex;"><span>rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
</span></span><span style="display:flex;"><span>yum upgrade -y
</span></span><span style="display:flex;"><span>yum install -y java-11-openjdk jenkins
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Start Jenkins</span>
</span></span><span style="display:flex;"><span>systemctl start jenkins
</span></span><span style="display:flex;"><span>systemctl enable jenkins
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install kubectl</span>
</span></span><span style="display:flex;"><span>curl -o kubectl https://amazon-eks.s3.us-west-2.amazonaws.com/1.21.2/2021-07-05/bin/linux/amd64/kubectl
</span></span><span style="display:flex;"><span>chmod +x ./kubectl
</span></span><span style="display:flex;"><span>mv ./kubectl /usr/local/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install AWS CLI v2</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#e6db74">&#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&#34;</span> -o <span style="color:#e6db74">&#34;awscliv2.zip&#34;</span>
</span></span><span style="display:flex;"><span>unzip awscliv2.zip
</span></span><span style="display:flex;"><span>./aws/install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install Python and dependencies</span>
</span></span><span style="display:flex;"><span>yum install -y python3 python3-pip
</span></span><span style="display:flex;"><span>pip3 install boto3 sagemaker pandas scikit-learn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Configure Jenkins user for Docker</span>
</span></span><span style="display:flex;"><span>usermod -a -G docker jenkins
</span></span><span style="display:flex;"><span>systemctl restart jenkins
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Jenkins installation completed!&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Access Jenkins at: http://</span><span style="color:#66d9ef">$(</span>curl -s http://169.254.169.254/latest/meta-data/public-ip<span style="color:#66d9ef">)</span><span style="color:#e6db74">:8080&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Initial admin password: </span><span style="color:#66d9ef">$(</span>cat /var/lib/jenkins/secrets/initialAdminPassword<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><h4 id="33-jenkinsfile-for-ml-pipeline">3.3 Jenkinsfile for ML Pipeline</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span><span style="color:#75715e">// Jenkinsfile
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>pipeline <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    agent any
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    environment <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        AWS_DEFAULT_REGION <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;us-east-1&#39;</span>
</span></span><span style="display:flex;"><span>        AWS_ACCOUNT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;123456789012&#39;</span>
</span></span><span style="display:flex;"><span>        ECR_REPOSITORY <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;retail-forecast&#39;</span>
</span></span><span style="display:flex;"><span>        EKS_CLUSTER_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;retail-forecast-cluster&#39;</span>
</span></span><span style="display:flex;"><span>        NAMESPACE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mlops&#39;</span>
</span></span><span style="display:flex;"><span>        S3_DATA_BUCKET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;retail-forecast-data-bucket&#39;</span>
</span></span><span style="display:flex;"><span>        S3_ARTIFACTS_BUCKET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;retail-forecast-artifacts-bucket&#39;</span>
</span></span><span style="display:flex;"><span>        MODEL_PACKAGE_GROUP <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;retail-forecast-model-group&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    parameters <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        choice<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>            name: <span style="color:#e6db74">&#39;DEPLOY_ENVIRONMENT&#39;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            choices: <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;dev&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;staging&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;prod&#39;</span><span style="color:#f92672">],</span>
</span></span><span style="display:flex;"><span>            description: <span style="color:#e6db74">&#39;Target deployment environment&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        booleanParam<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>            name: <span style="color:#e6db74">&#39;RETRAIN_MODEL&#39;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            defaultValue: <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            description: <span style="color:#e6db74">&#39;Force model retraining&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        booleanParam<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>            name: <span style="color:#e6db74">&#39;SKIP_TESTS&#39;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            defaultValue: <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            description: <span style="color:#e6db74">&#39;Skip test execution&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    stages <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Setup&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Clean workspace
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    cleanWs<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Checkout code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    checkout scm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Set build info
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    env<span style="color:#f92672">.</span><span style="color:#a6e22e">BUILD_VERSION</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;${env.BUILD_NUMBER}-${env.GIT_COMMIT.take(7)}&#34;</span>
</span></span><span style="display:flex;"><span>                    env<span style="color:#f92672">.</span><span style="color:#a6e22e">IMAGE_TAG</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;v${env.BUILD_VERSION}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    echo <span style="color:#e6db74">&#34;Build Version: ${env.BUILD_VERSION}&#34;</span>
</span></span><span style="display:flex;"><span>                    echo <span style="color:#e6db74">&#34;Image Tag: ${env.IMAGE_TAG}&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Environment Setup&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Install Python dependencies
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        python3 -m venv venv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        pip install --upgrade pip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        pip install -r requirements.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        pip install pytest pytest-cov flake8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Configure AWS credentials
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        aws sts get-caller-identity
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        aws configure set region $AWS_DEFAULT_REGION
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Configure kubectl
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        aws eks update-kubeconfig --name $EKS_CLUSTER_NAME --region $AWS_DEFAULT_REGION
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        kubectl cluster-info
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Code Quality &amp; Testing&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            when <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                not <span style="color:#f92672">{</span> params<span style="color:#f92672">.</span><span style="color:#a6e22e">SKIP_TESTS</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            parallel <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Linting&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            flake8 src/ --max-line-length=88 --exclude=venv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Unit Tests&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            pytest tests/unit/ -v --cov=src --cov-report=xml --cov-report=html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// Publish test results
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        publishTestResults testResultsPattern: <span style="color:#e6db74">&#39;test-results.xml&#39;</span>
</span></span><span style="display:flex;"><span>                        publishCoverage adapters: <span style="color:#f92672">[</span>coberturaAdapter<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;coverage.xml&#39;</span><span style="color:#f92672">)],</span> sourceFileResolver: sourceFiles<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;STORE_LAST_BUILD&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Integration Tests&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            pytest tests/integration/ -v
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Data Validation&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        python scripts/validate_data.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --bucket $S3_DATA_BUCKET \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --key training-data/train.csv \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --output data-validation-report.json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Archive validation report
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    archiveArtifacts artifacts: <span style="color:#e6db74">&#39;data-validation-report.json&#39;</span><span style="color:#f92672">,</span> fingerprint: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Model Training&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            when <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                anyOf <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    params<span style="color:#f92672">.</span><span style="color:#a6e22e">RETRAIN_MODEL</span>
</span></span><span style="display:flex;"><span>                    changeset <span style="color:#e6db74">&#34;src/training/**&#34;</span>
</span></span><span style="display:flex;"><span>                    changeset <span style="color:#e6db74">&#34;data/**&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        python scripts/trigger_training.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --job-name &#34;retail-forecast-training-${BUILD_VERSION}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --data-bucket $S3_DATA_BUCKET \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --output-bucket $S3_ARTIFACTS_BUCKET \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --role-arn arn:aws:iam::$AWS_ACCOUNT_ID:role/SageMakerExecutionRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Wait for training completion
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        python scripts/wait_for_training.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --job-name &#34;retail-forecast-training-${BUILD_VERSION}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --timeout 3600
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Model Validation &amp; Registration&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            when <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                anyOf <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    params<span style="color:#f92672">.</span><span style="color:#a6e22e">RETRAIN_MODEL</span>
</span></span><span style="display:flex;"><span>                    changeset <span style="color:#e6db74">&#34;src/training/**&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Validate model performance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        python scripts/validate_model.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --job-name &#34;retail-forecast-training-${BUILD_VERSION}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --baseline-accuracy 0.85 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --output model-validation-report.json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Register model if validation passes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        source venv/bin/activate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        python scripts/register_model.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --job-name &#34;retail-forecast-training-${BUILD_VERSION}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --model-package-group $MODEL_PACKAGE_GROUP \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --approval-status &#34;PendingManualApproval&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --model-version $BUILD_VERSION
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    archiveArtifacts artifacts: <span style="color:#e6db74">&#39;model-validation-report.json&#39;</span><span style="color:#f92672">,</span> fingerprint: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Docker Build&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Build Docker image
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Get latest approved model
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        MODEL_URI=$(python scripts/get_latest_model.py --model-package-group $MODEL_PACKAGE_GROUP)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        echo &#34;Using model: $MODEL_URI&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Build image with model URI
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        docker build \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --build-arg MODEL_URI=$MODEL_URI \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --build-arg BUILD_VERSION=$BUILD_VERSION \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            -t $ECR_REPOSITORY:$IMAGE_TAG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            -t $ECR_REPOSITORY:latest \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            .
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Security scan
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            -v $(pwd):/root/.cache/ \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            aquasec/trivy:latest image \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --exit-code 1 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --severity HIGH,CRITICAL \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            $ECR_REPOSITORY:$IMAGE_TAG
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Push to ECR&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Login to ECR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        aws ecr get-login-password --region $AWS_DEFAULT_REGION | \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            docker login --username AWS --password-stdin \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Tag images
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        docker tag $ECR_REPOSITORY:$IMAGE_TAG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$ECR_REPOSITORY:$IMAGE_TAG
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        docker tag $ECR_REPOSITORY:latest \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$ECR_REPOSITORY:latest
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Push images
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        docker push $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$ECR_REPOSITORY:$IMAGE_TAG
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        docker push $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$ECR_REPOSITORY:latest
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Deploy to EKS&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Update Kubernetes deployment
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Update deployment image
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        kubectl set image deployment/retail-forecast-api \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            retail-forecast-api=$AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$ECR_REPOSITORY:$IMAGE_TAG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            -n $NAMESPACE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Wait for rollout
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        kubectl rollout status deployment/retail-forecast-api -n $NAMESPACE --timeout=600s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Verify deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        kubectl get pods -n $NAMESPACE -l app=retail-forecast-api
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Health Check&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Get service endpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        ENDPOINT=$(kubectl get service retail-forecast-service -n $NAMESPACE -o jsonpath=&#39;{.status.loadBalancer.ingress[0].hostname}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        if [ -z &#34;$ENDPOINT&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            ENDPOINT=$(kubectl get service retail-forecast-service -n $NAMESPACE -o jsonpath=&#39;{.spec.clusterIP}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            kubectl port-forward service/retail-forecast-service 8080:80 -n $NAMESPACE &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            ENDPOINT=&#34;localhost:8080&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            PORT_FORWARD_PID=$!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Wait for service to be ready
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        echo &#34;Waiting for service to be ready...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        for i in {1..30}; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            if curl -f http://$ENDPOINT/healthz; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                echo &#34;Service is healthy!&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                break
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            echo &#34;Attempt $i/30 failed, retrying in 10 seconds...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            sleep 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Test prediction endpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        curl -X POST http://$ENDPOINT/predict \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            -H &#34;Content-Type: application/json&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            -d &#39;{&#34;features&#34;: {&#34;store_id&#34;: 1, &#34;product_id&#34;: 123, &#34;price&#34;: 29.99}}&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Kill port-forward if used
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        if [ ! -z &#34;$PORT_FORWARD_PID&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            kill $PORT_FORWARD_PID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stage<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Performance Testing&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            when <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                environment name: <span style="color:#e6db74">&#39;DEPLOY_ENVIRONMENT&#39;</span><span style="color:#f92672">,</span> value: <span style="color:#e6db74">&#39;prod&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        # Run load test
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        python scripts/load_test.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --endpoint http://$ENDPOINT \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --duration 300 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --concurrent-users 10 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            --output load-test-report.json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    archiveArtifacts artifacts: <span style="color:#e6db74">&#39;load-test-report.json&#39;</span><span style="color:#f92672">,</span> fingerprint: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    post <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        always <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Clean up
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                docker system prune -f
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                rm -rf venv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Archive logs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            archiveArtifacts artifacts: <span style="color:#e6db74">&#39;logs/**&#39;</span><span style="color:#f92672">,</span> allowEmptyArchive: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        success <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Send success notification
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    aws sns publish \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        --topic-arn arn:aws:sns:$AWS_DEFAULT_REGION:$AWS_ACCOUNT_ID:deployment-notifications \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        --message &#34;‚úÖ Deployment successful for build $BUILD_VERSION&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        --subject &#34;Retail Forecast Deployment Success&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        failure <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Send failure notification
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    aws sns publish \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        --topic-arn arn:aws:sns:$AWS_DEFAULT_REGION:$AWS_ACCOUNT_ID:deployment-notifications \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        --message &#34;‚ùå Deployment failed for build $BUILD_VERSION. Check Jenkins logs.&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        --subject &#34;Retail Forecast Deployment Failed&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Rollback on production failure
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>params<span style="color:#f92672">.</span><span style="color:#a6e22e">DEPLOY_ENVIRONMENT</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;prod&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    sh <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        echo &#34;Rolling back production deployment...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        kubectl rollout undo deployment/retail-forecast-api -n $NAMESPACE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        kubectl rollout status deployment/retail-forecast-api -n $NAMESPACE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="2-github-actions-cicd-pipeline">2. GitHub Actions CI/CD Pipeline</h2>
<p>Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng GitHub Actions ƒë·ªÉ x√¢y d·ª±ng pipeline CI/CD cho d·ª± √°n MLOps Retail Prediction v√¨ kh·∫£ nƒÉng t√≠ch h·ª£p s·∫µn v·ªõi GitHub repository v√† t√≠nh linh ho·∫°t cao.</p>
<h3 id="21-c·∫•u-h√¨nh-workflow-file">2.1 C·∫•u h√¨nh workflow file</h3>
<p>T·∫°o file <code>.github/workflows/mlops-pipeline.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># .github/workflows/mlops-pipeline.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">MLOps Retail Prediction Pipeline</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [<span style="color:#ae81ff">main, develop]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">paths-ignore</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;**.md&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;docs/**&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pull_request</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [<span style="color:#ae81ff">main]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedule</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Ch·∫°y m·ªói tu·∫ßn v√†o th·ª© 2 ƒë·ªÉ ki·ªÉm tra ƒë·ªô ch√≠nh x√°c c·ªßa model</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">cron</span>: <span style="color:#e6db74">&#34;0 2 * * 1&#34;</span> <span style="color:#75715e"># Run weekly on Monday to verify model accuracy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">workflow_dispatch</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">inputs</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;Deployment environment&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default</span>: <span style="color:#e6db74">&#34;dev&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">choice</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">options</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">staging</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">prod</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">retrain_model</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;Retrain model&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">required</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">boolean</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">deploy_only</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;Deploy only (do not build/retrain)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">required</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">boolean</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">AWS_REGION</span>: <span style="color:#ae81ff">us-east-1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ECR_REPOSITORY</span>: <span style="color:#ae81ff">retail-forecast</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">EKS_CLUSTER_NAME</span>: <span style="color:#ae81ff">retail-forecast-cluster</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">S3_DATA_BUCKET</span>: <span style="color:#ae81ff">retail-forecast-data</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">S3_MODEL_BUCKET</span>: <span style="color:#ae81ff">retail-forecast-models</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">MODEL_PACKAGE_GROUP</span>: <span style="color:#ae81ff">retail-forecast-models</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">permissions</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">id-token</span>: <span style="color:#ae81ff">write</span> <span style="color:#75715e"># C·∫ßn thi·∫øt cho OIDC v·ªõi AWS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">contents</span>: <span style="color:#ae81ff">read</span> <span style="color:#75715e"># C·∫ßn thi·∫øt ƒë·ªÉ checkout code</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">setup</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup Pipeline</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">outputs</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">build-id</span>: <span style="color:#ae81ff">${{ steps.generate-id.outputs.build_id }}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">environment</span>: <span style="color:#ae81ff">${{ steps.set-env.outputs.environment }}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">should-train</span>: <span style="color:#ae81ff">${{ steps.set-env.outputs.should_train }}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">should-deploy</span>: <span style="color:#ae81ff">${{ steps.set-env.outputs.should_deploy }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Generate build ID</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">generate-id</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          BUILD_ID=&#34;build-${GITHUB_RUN_NUMBER}-${GITHUB_SHA::7}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;build_id=$BUILD_ID&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Build ID: $BUILD_ID&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Set environment variables</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">set-env</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # X√°c ƒë·ªãnh m√¥i tr∆∞·ªùng
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [[ &#34;${{ github.event_name }}&#34; == &#34;workflow_dispatch&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ENV=&#34;${{ github.event.inputs.environment }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          elif [[ &#34;${{ github.ref }}&#34; == &#34;refs/heads/main&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ENV=&#34;prod&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          elif [[ &#34;${{ github.ref }}&#34; == &#34;refs/heads/develop&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ENV=&#34;staging&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ENV=&#34;dev&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;environment=$ENV&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # X√°c ƒë·ªãnh c√≥ n√™n hu·∫•n luy·ªán model hay kh√¥ng
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [[ &#34;${{ github.event.inputs.retrain_model }}&#34; == &#34;true&#34; ]] || \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             [[ &#34;${{ github.event_name }}&#34; == &#34;schedule&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            SHOULD_TRAIN=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            SHOULD_TRAIN=&#34;false&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;should_train=$SHOULD_TRAIN&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # X√°c ƒë·ªãnh c√≥ n√™n deploy hay kh√¥ng
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [[ &#34;${{ github.event.inputs.deploy_only }}&#34; == &#34;true&#34; ]] || \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             [[ &#34;$ENV&#34; == &#34;prod&#34; &amp;&amp; &#34;${{ github.ref }}&#34; == &#34;refs/heads/main&#34; ]] || \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             [[ &#34;$ENV&#34; == &#34;staging&#34; &amp;&amp; &#34;${{ github.ref }}&#34; == &#34;refs/heads/develop&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            SHOULD_DEPLOY=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            SHOULD_DEPLOY=&#34;false&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;should_deploy=$SHOULD_DEPLOY&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # In th√¥ng tin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Environment: $ENV&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Should train model: $SHOULD_TRAIN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Should deploy: $SHOULD_DEPLOY&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">test</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Code Quality &amp; Testing</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: <span style="color:#ae81ff">setup</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup Python</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-python@v4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">python-version</span>: <span style="color:#e6db74">&#34;3.10&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cache</span>: <span style="color:#e6db74">&#34;pip&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install dependencies</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          python -m pip install --upgrade pip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          pip install -r core/requirements.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          pip install -r server/requirements.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          pip install pytest pytest-cov pylint black</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Code formatting check</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          black --check core/ server/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Lint code</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          pylint --disable=C0111,C0103 core/ server/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Run tests</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          pytest tests/ -v --cov=core --cov=server --cov-report=xml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Upload coverage report</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">codecov/codecov-action@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">file</span>: <span style="color:#ae81ff">./coverage.xml</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">fail_ci_if_error</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">data_validation</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Data Validation</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: [<span style="color:#ae81ff">setup, test]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">if</span>: <span style="color:#ae81ff">needs.setup.outputs.should_train == &#39;true&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Configure AWS credentials</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/configure-aws-credentials@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">role-to-assume</span>: <span style="color:#ae81ff">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/GitHubActionsRole</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">aws-region</span>: <span style="color:#ae81ff">${{ env.AWS_REGION }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup Python</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-python@v4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">python-version</span>: <span style="color:#e6db74">&#34;3.10&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cache</span>: <span style="color:#e6db74">&#34;pip&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install dependencies</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          pip install pandas boto3 great_expectations</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Validate training data</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          python aws/script/validate_data.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --bucket ${{ env.S3_DATA_BUCKET }} \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --key training/sales_data.csv \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --output validation_report.json</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Upload validation report</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/upload-artifact@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">data-validation-report</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">validation_report.json</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">model_training</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Model Training</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: [<span style="color:#ae81ff">setup, test, data_validation]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">if</span>: <span style="color:#ae81ff">needs.setup.outputs.should_train == &#39;true&#39; &amp;&amp; success()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Configure AWS credentials</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/configure-aws-credentials@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">role-to-assume</span>: <span style="color:#ae81ff">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/GitHubActionsRole</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">aws-region</span>: <span style="color:#ae81ff">${{ env.AWS_REGION }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup Python</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-python@v4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">python-version</span>: <span style="color:#e6db74">&#34;3.10&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cache</span>: <span style="color:#e6db74">&#34;pip&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install dependencies</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          pip install boto3 sagemaker pandas scikit-learn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create training job</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">training</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          python aws/script/create_training_job.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --job-name &#34;retail-forecast-${{ needs.setup.outputs.build-id }}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --data-bucket ${{ env.S3_DATA_BUCKET }} \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --output-bucket ${{ env.S3_MODEL_BUCKET }} \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --instance-type ml.m5.large \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --hyperparameters &#34;{\&#34;n_estimators\&#34;:\&#34;200\&#34;,\&#34;max_depth\&#34;:\&#34;10\&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Wait for training completion</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          aws sagemaker wait training-job-completed-or-stopped \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --training-job-name &#34;retail-forecast-${{ needs.setup.outputs.build-id }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          STATUS=$(aws sagemaker describe-training-job \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --training-job-name &#34;retail-forecast-${{ needs.setup.outputs.build-id }}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --query &#39;TrainingJobStatus&#39; --output text)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [ &#34;$STATUS&#34; != &#34;Completed&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;Training failed with status: $STATUS&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">model_evaluation</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Model Evaluation &amp; Registration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: [<span style="color:#ae81ff">setup, model_training]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">outputs</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">model_approved</span>: <span style="color:#ae81ff">${{ steps.evaluate.outputs.model_approved }}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">model_version</span>: <span style="color:#ae81ff">${{ steps.register.outputs.model_version }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Configure AWS credentials</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/configure-aws-credentials@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">role-to-assume</span>: <span style="color:#ae81ff">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/GitHubActionsRole</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">aws-region</span>: <span style="color:#ae81ff">${{ env.AWS_REGION }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup Python</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-python@v4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">python-version</span>: <span style="color:#e6db74">&#34;3.10&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cache</span>: <span style="color:#e6db74">&#34;pip&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install dependencies</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          pip install boto3 sagemaker pandas scikit-learn matplotlib seaborn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Evaluate model</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">evaluate</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          python aws/script/processing_evaluate.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --job-name &#34;retail-forecast-${{ needs.setup.outputs.build-id }}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --evaluation-data s3://${{ env.S3_DATA_BUCKET }}/validation/sales_data.csv \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --baseline-metrics s3://${{ env.S3_MODEL_BUCKET }}/baselines/metrics.json \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --threshold 0.85
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Check result
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [ -f &#34;model_approved.txt&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            MODEL_APPROVED=$(cat model_approved.txt)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;model_approved=$MODEL_APPROVED&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;Model evaluation result: $MODEL_APPROVED&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;model_approved=false&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;Model evaluation failed&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Register model</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">register</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">if</span>: <span style="color:#ae81ff">steps.evaluate.outputs.model_approved == &#39;true&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          MODEL_VERSION=$(python aws/script/register_model.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --job-name &#34;retail-forecast-${{ needs.setup.outputs.build-id }}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --model-package-group ${{ env.MODEL_PACKAGE_GROUP }} \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --approval-status &#34;Approved&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;model_version=$MODEL_VERSION&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Model registered with version: $MODEL_VERSION&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Upload evaluation results</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/upload-artifact@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">model-evaluation-report</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            evaluation_results.json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            plots/*.png</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build_docker</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build &amp; Push Docker Image</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: [<span style="color:#ae81ff">setup, test]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">outputs</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image_tag</span>: <span style="color:#ae81ff">${{ steps.build.outputs.image_tag }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Configure AWS credentials</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/configure-aws-credentials@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">role-to-assume</span>: <span style="color:#ae81ff">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/GitHubActionsRole</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">aws-region</span>: <span style="color:#ae81ff">${{ env.AWS_REGION }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Login to Amazon ECR</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">login-ecr</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/amazon-ecr-login@v1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build and push Docker image</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">ECR_REGISTRY</span>: <span style="color:#ae81ff">${{ steps.login-ecr.outputs.registry }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Set tag
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          IMAGE_TAG=&#34;${{ needs.setup.outputs.build-id }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;image_tag=$IMAGE_TAG&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Get latest model URI (or use placeholder for dev environment)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [[ &#34;${{ needs.setup.outputs.environment }}&#34; == &#34;dev&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            MODEL_URI=&#34;placeholder&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            MODEL_URI=$(aws sagemaker list-model-packages \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              --model-package-group-name ${{ env.MODEL_PACKAGE_GROUP }} \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              --sort-by CreationTime --sort-order Descending --max-items 1 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              --query &#39;ModelPackageSummaries[0].ModelPackageArn&#39; --output text)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Using model URI: $MODEL_URI&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Build image
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --build-arg MODEL_URI=$MODEL_URI \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --build-arg BUILD_ID=$IMAGE_TAG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --build-arg ENV=${{ needs.setup.outputs.environment }} \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            server/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Also tag as latest-{environment}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker tag $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            $ECR_REGISTRY/$ECR_REPOSITORY:latest-${{ needs.setup.outputs.environment }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Security scan
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            aquasec/trivy:latest image --severity HIGH,CRITICAL \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Push images
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker push $ECR_REGISTRY/$ECR_REPOSITORY:latest-${{ needs.setup.outputs.environment }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Image built and pushed: $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">deploy_eks</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy to EKS</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: [<span style="color:#ae81ff">setup, test, build_docker, model_evaluation]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">if</span>: <span style="color:#ae81ff">needs.setup.outputs.should_deploy == &#39;true&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">${{ needs.setup.outputs.environment }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Configure AWS credentials</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/configure-aws-credentials@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">role-to-assume</span>: <span style="color:#ae81ff">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/GitHubActionsRole</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">aws-region</span>: <span style="color:#ae81ff">${{ env.AWS_REGION }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Login to Amazon ECR</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">login-ecr</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/amazon-ecr-login@v1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Update kubeconfig</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          aws eks update-kubeconfig --name ${{ env.EKS_CLUSTER_NAME }} --region ${{ env.AWS_REGION }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check if need to deploy new model</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">check-model</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [[ &#34;${{ needs.model_evaluation.outputs.model_approved }}&#34; == &#34;true&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;deploy_new_model=true&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;deploy_new_model=false&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy to EKS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Set environment variables
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          NAMESPACE=&#34;retail-forecast-${{ needs.setup.outputs.environment }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          IMAGE_TAG=&#34;${{ needs.build_docker.outputs.image_tag }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          ECR_REGISTRY=&#34;${{ steps.login-ecr.outputs.registry }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Update kustomization file with new image
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          cd aws/k8s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          kustomize edit set image retail-forecast-api=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Apply changes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          kubectl apply -k overlays/${{ needs.setup.outputs.environment }}/ --namespace $NAMESPACE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Wait for deployment to complete
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          kubectl rollout status deployment/retail-forecast-api -n $NAMESPACE --timeout=300s</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create SageMaker endpoint (if new model approved)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">if</span>: <span style="color:#ae81ff">steps.check-model.outputs.deploy_new_model == &#39;true&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          python aws/script/deploy_endpoint.py \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --model-package-arn &#34;arn:aws:sagemaker:${{ env.AWS_REGION }}:${{ secrets.AWS_ACCOUNT_ID }}:model-package/${{ env.MODEL_PACKAGE_GROUP }}/${{ needs.model_evaluation.outputs.model_version }}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --endpoint-name &#34;retail-forecast-${{ needs.setup.outputs.environment }}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --instance-type ml.t2.medium \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --instance-count 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Health check</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Get service endpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          NAMESPACE=&#34;retail-forecast-${{ needs.setup.outputs.environment }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          SERVICE_HOST=$(kubectl get ingress -n $NAMESPACE retail-forecast-ingress -o jsonpath=&#39;{.status.loadBalancer.ingress[0].hostname}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # If running locally, use port-forwarding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [ -z &#34;$SERVICE_HOST&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;No external hostname found, using port-forwarding&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            kubectl port-forward svc/retail-forecast-service 8080:80 -n $NAMESPACE &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            SERVICE_HOST=&#34;localhost:8080&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Check health endpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Testing health endpoint: http://$SERVICE_HOST/health&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          HEALTH_STATUS=$(curl -s -o /dev/null -w &#34;%{http_code}&#34; http://$SERVICE_HOST/health)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [ &#34;$HEALTH_STATUS&#34; -eq 200 ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;Health check passed: $HEALTH_STATUS&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;Health check failed: $HEALTH_STATUS&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Test prediction endpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Testing prediction endpoint&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          PREDICTION_RESULT=$(curl -s -X POST \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            -H &#34;Content-Type: application/json&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            -d &#39;{&#34;store_id&#34;: 1, &#34;item_id&#34;: 123, &#34;date&#34;: &#34;2023-06-15&#34;}&#39; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            http://$SERVICE_HOST/predict)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Prediction result: $PREDICTION_RESULT&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Check if response contains prediction
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [[ $PREDICTION_RESULT == *&#34;prediction&#34;* ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;Prediction endpoint working correctly&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;Prediction endpoint not returning expected response&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">monitoring</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup Monitoring</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: [<span style="color:#ae81ff">setup, deploy_eks]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">if</span>: <span style="color:#ae81ff">always() &amp;&amp; needs.deploy_eks.result == &#39;success&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Configure AWS credentials</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/configure-aws-credentials@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">role-to-assume</span>: <span style="color:#ae81ff">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/GitHubActionsRole</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">aws-region</span>: <span style="color:#ae81ff">${{ env.AWS_REGION }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup CloudWatch alarms for new deployment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Create/update CloudWatch alarms for API and model performance
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          NAMESPACE=&#34;retail-forecast-${{ needs.setup.outputs.environment }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          DEPLOYMENT_ID=&#34;${{ needs.setup.outputs.build-id }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          aws cloudwatch put-metric-alarm \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --alarm-name &#34;RetailForecast-API-Error-Rate-$NAMESPACE&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --alarm-description &#34;Monitor error rate for Retail Forecast API&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --metric-name &#34;ErrorRate&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --namespace &#34;RetailForecast/$NAMESPACE&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --statistic &#34;Average&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --period 60 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --threshold 5 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --comparison-operator &#34;GreaterThanThreshold&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --evaluation-periods 3 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --alarm-actions &#34;arn:aws:sns:${{ env.AWS_REGION }}:${{ secrets.AWS_ACCOUNT_ID }}:retail-forecast-alerts&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --dimensions &#34;Name=DeploymentId,Value=$DEPLOYMENT_ID&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          aws cloudwatch put-metric-alarm \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --alarm-name &#34;RetailForecast-API-Latency-$NAMESPACE&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --alarm-description &#34;Monitor latency for Retail Forecast API&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --metric-name &#34;Latency&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --namespace &#34;RetailForecast/$NAMESPACE&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --statistic &#34;Average&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --period 60 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --threshold 1000 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --comparison-operator &#34;GreaterThanThreshold&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --evaluation-periods 3 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --alarm-actions &#34;arn:aws:sns:${{ env.AWS_REGION }}:${{ secrets.AWS_ACCOUNT_ID }}:retail-forecast-alerts&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --dimensions &#34;Name=DeploymentId,Value=$DEPLOYMENT_ID&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;CloudWatch alarms configured successfully&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">notify</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Send Notifications</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: [<span style="color:#ae81ff">setup, deploy_eks, monitoring]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">if</span>: <span style="color:#ae81ff">always()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Determine workflow status</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">status</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if [[ &#34;${{ needs.deploy_eks.result }}&#34; == &#34;success&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;result=success&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;message=‚úÖ Deployment successful for ${{ needs.setup.outputs.environment }} environment (Build ${{ needs.setup.outputs.build-id }})&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          elif [[ &#34;${{ needs.deploy_eks.result }}&#34; == &#34;failure&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;result=failure&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;message=‚ùå Deployment failed for ${{ needs.setup.outputs.environment }} environment (Build ${{ needs.setup.outputs.build-id }})&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;result=skipped&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            echo &#34;message=‚ÑπÔ∏è Deployment skipped for ${{ needs.setup.outputs.environment }} environment (Build ${{ needs.setup.outputs.build-id }})&#34; &gt;&gt; $GITHUB_OUTPUT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Configure AWS credentials</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">if</span>: <span style="color:#ae81ff">steps.status.outputs.result != &#39;skipped&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">aws-actions/configure-aws-credentials@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">role-to-assume</span>: <span style="color:#ae81ff">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/GitHubActionsRole</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">aws-region</span>: <span style="color:#ae81ff">${{ env.AWS_REGION }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Send SNS notification</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">if</span>: <span style="color:#ae81ff">steps.status.outputs.result != &#39;skipped&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          aws sns publish \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --topic-arn &#34;arn:aws:sns:${{ env.AWS_REGION }}:${{ secrets.AWS_ACCOUNT_ID }}:retail-forecast-alerts&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --subject &#34;Retail Forecast Deployment: ${{ steps.status.outputs.result }}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --message &#34;${{ steps.status.outputs.message }}&#34;</span>
</span></span></code></pre></div><h2 id="3-iam-role-v√†-quy·ªÅn-h·∫°n">3. IAM Role v√† Quy·ªÅn h·∫°n</h2>
<p>ƒê·ªÉ GitHub Actions c√≥ th·ªÉ t∆∞∆°ng t√°c v·ªõi c√°c d·ªãch v·ª• AWS, ch√∫ng ta c·∫ßn thi·∫øt l·∫≠p IAM Role v·ªõi quy·ªÅn h·∫°n ph√π h·ª£p v√† s·ª≠ d·ª•ng OIDC ƒë·ªÉ x√°c th·ª±c.</p>
<h3 id="31-t·∫°o-iam-role-cho-github-actions">3.1 T·∫°o IAM Role cho GitHub Actions</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># T·∫°o IAM Role cho GitHub Actions</span>
</span></span><span style="display:flex;"><span>cat &gt; trust-policy.json <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Statement&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Principal&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;Federated&#34;: &#34;arn:aws:iam::&lt;ACCOUNT_ID&gt;:oidc-provider/token.actions.githubusercontent.com&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Action&#34;: &#34;sts:AssumeRoleWithWebIdentity&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Condition&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;StringEquals&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;token.actions.githubusercontent.com:aud&#34;: &#34;sts.amazonaws.com&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;StringLike&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;token.actions.githubusercontent.com:sub&#34;: &#34;repo:&lt;GITHUB_ORG&gt;/&lt;REPO_NAME&gt;:*&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># T·∫°o role</span>
</span></span><span style="display:flex;"><span>aws iam create-role --role-name GitHubActionsRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --assume-role-policy-document file://trust-policy.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --description <span style="color:#e6db74">&#34;Role for GitHub Actions CI/CD pipeline&#34;</span>
</span></span></code></pre></div><h3 id="32-iam-policy-cho-cicd-pipeline">3.2 IAM Policy cho CI/CD Pipeline</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>, <span style="color:#e6db74">&#34;s3:PutObject&#34;</span>, <span style="color:#e6db74">&#34;s3:ListBucket&#34;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:s3:::retail-forecast-data*&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:s3:::retail-forecast-data*/*&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:s3:::retail-forecast-models*&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:s3:::retail-forecast-models*/*&#34;</span>
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateTrainingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeTrainingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:StopTrainingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:ListTrainingJobs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateProcessingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeProcessingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:StopProcessingJob&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateModel&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DeleteModel&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeModel&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateEndpoint&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeEndpoint&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DeleteEndpoint&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:UpdateEndpoint&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateEndpointConfig&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DeleteEndpointConfig&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeEndpointConfig&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateModelPackageGroup&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeModelPackageGroup&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:ListModelPackageGroups&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:CreateModelPackage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:DescribeModelPackage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:ListModelPackages&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sagemaker:UpdateModelPackage&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:GetAuthorizationToken&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:BatchCheckLayerAvailability&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:GetDownloadUrlForLayer&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:BatchGetImage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:InitiateLayerUpload&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:UploadLayerPart&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:CompleteLayerUpload&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:PutImage&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:ListImages&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecr:DescribeImages&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [<span style="color:#e6db74">&#34;eks:DescribeCluster&#34;</span>, <span style="color:#e6db74">&#34;eks:ListClusters&#34;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cloudwatch:PutMetricData&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cloudwatch:GetMetricData&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cloudwatch:PutMetricAlarm&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cloudwatch:DescribeAlarms&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cloudwatch:DeleteAlarms&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:CreateLogGroup&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:CreateLogStream&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:PutLogEvents&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:DescribeLogStreams&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [<span style="color:#e6db74">&#34;sns:Publish&#34;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:sns:*:*:retail-forecast-*&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="33-g·∫Øn-policy-cho-role">3.3 G·∫Øn Policy cho Role</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># T·∫°o v√† g·∫Øn policy</span>
</span></span><span style="display:flex;"><span>aws iam create-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-name GitHubActionsPolicy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-document file://github-actions-policy.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam attach-role-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name GitHubActionsRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::&lt;ACCOUNT_ID&gt;:policy/GitHubActionsPolicy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># G·∫Øn th√™m c√°c managed policy c·∫ßn thi·∫øt</span>
</span></span><span style="display:flex;"><span>aws iam attach-role-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name GitHubActionsRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::aws:policy/AmazonEKSClusterPolicy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam attach-role-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name GitHubActionsRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::aws:policy/AmazonECR-FullAccess
</span></span></code></pre></div><h2 id="4-script-h·ªó-tr·ª£-cho-pipeline">4. Script h·ªó tr·ª£ cho Pipeline</h2>
<h3 id="41-script-t·∫°o-training-job">4.1 Script t·∫°o Training Job</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># aws/script/create_training_job.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_training_job</span>(job_name, data_bucket, output_bucket,
</span></span><span style="display:flex;"><span>                        instance_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ml.m5.large&#39;</span>,
</span></span><span style="display:flex;"><span>                        hyperparameters<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    T·∫°o SageMaker training job cho Retail Forecast model
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    sagemaker <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;sagemaker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> hyperparameters <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        hyperparameters <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;n_estimators&#39;</span>: <span style="color:#e6db74">&#39;100&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;max_depth&#39;</span>: <span style="color:#e6db74">&#39;10&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;random_state&#39;</span>: <span style="color:#e6db74">&#39;42&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> isinstance(hyperparameters, str):
</span></span><span style="display:flex;"><span>        hyperparameters <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(hyperparameters)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># L·∫•y SageMaker execution role t·ª´ m√¥i tr∆∞·ªùng ho·∫∑c t·∫°o m·ªõi</span>
</span></span><span style="display:flex;"><span>    role_arn <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;SAGEMAKER_ROLE_ARN&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> role_arn:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># T√¨m role m·∫∑c ƒë·ªãnh</span>
</span></span><span style="display:flex;"><span>        iam <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;iam&#39;</span>)
</span></span><span style="display:flex;"><span>        paginator <span style="color:#f92672">=</span> iam<span style="color:#f92672">.</span>get_paginator(<span style="color:#e6db74">&#39;list_roles&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> page <span style="color:#f92672">in</span> paginator<span style="color:#f92672">.</span>paginate():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> role <span style="color:#f92672">in</span> page[<span style="color:#e6db74">&#39;Roles&#39;</span>]:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;AmazonSageMaker-ExecutionRole&#39;</span> <span style="color:#f92672">in</span> role[<span style="color:#e6db74">&#39;RoleName&#39;</span>]:
</span></span><span style="display:flex;"><span>                    role_arn <span style="color:#f92672">=</span> role[<span style="color:#e6db74">&#39;Arn&#39;</span>]
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> role_arn:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Kh√¥ng t√¨m th·∫•y SageMaker execution role&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># C·∫•u h√¨nh training job</span>
</span></span><span style="display:flex;"><span>    training_params <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;TrainingJobName&#39;</span>: job_name,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;HyperParameters&#39;</span>: hyperparameters,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;AlgorithmSpecification&#39;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;TrainingImage&#39;</span>: <span style="color:#e6db74">&#39;683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-scikit-learn:1.0-1-cpu-py3&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;TrainingInputMode&#39;</span>: <span style="color:#e6db74">&#39;File&#39;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;RoleArn&#39;</span>: role_arn,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;InputDataConfig&#39;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;ChannelName&#39;</span>: <span style="color:#e6db74">&#39;train&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;DataSource&#39;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;S3DataSource&#39;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;S3DataType&#39;</span>: <span style="color:#e6db74">&#39;S3Prefix&#39;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;S3Uri&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;s3://</span><span style="color:#e6db74">{</span>data_bucket<span style="color:#e6db74">}</span><span style="color:#e6db74">/training/&#39;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;S3DataDistributionType&#39;</span>: <span style="color:#e6db74">&#39;FullyReplicated&#39;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;ContentType&#39;</span>: <span style="color:#e6db74">&#39;text/csv&#39;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;ChannelName&#39;</span>: <span style="color:#e6db74">&#39;validation&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;DataSource&#39;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;S3DataSource&#39;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;S3DataType&#39;</span>: <span style="color:#e6db74">&#39;S3Prefix&#39;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;S3Uri&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;s3://</span><span style="color:#e6db74">{</span>data_bucket<span style="color:#e6db74">}</span><span style="color:#e6db74">/validation/&#39;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;S3DataDistributionType&#39;</span>: <span style="color:#e6db74">&#39;FullyReplicated&#39;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;ContentType&#39;</span>: <span style="color:#e6db74">&#39;text/csv&#39;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;OutputDataConfig&#39;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;S3OutputPath&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;s3://</span><span style="color:#e6db74">{</span>output_bucket<span style="color:#e6db74">}</span><span style="color:#e6db74">/models/&#39;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;ResourceConfig&#39;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;InstanceType&#39;</span>: instance_type,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;InstanceCount&#39;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;VolumeSizeInGB&#39;</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;StoppingCondition&#39;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;MaxRuntimeInSeconds&#39;</span>: <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Tags&#39;</span>: [
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#39;Key&#39;</span>: <span style="color:#e6db74">&#39;Project&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#e6db74">&#39;RetailForecast&#39;</span>},
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#39;Key&#39;</span>: <span style="color:#e6db74">&#39;CreatedBy&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#e6db74">&#39;GitHubActions&#39;</span>},
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#39;Key&#39;</span>: <span style="color:#e6db74">&#39;Environment&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;ENVIRONMENT&#39;</span>, <span style="color:#e6db74">&#39;dev&#39;</span>)}
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T·∫°o training job</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>create_training_job(<span style="color:#f92672">**</span>training_params)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Training job created: </span><span style="color:#e6db74">{</span>job_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;ARN: </span><span style="color:#e6db74">{</span>response[<span style="color:#e6db74">&#39;TrainingJobArn&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> response[<span style="color:#e6db74">&#39;TrainingJobArn&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Create SageMaker training job&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--job-name&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Name for the training job&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--data-bucket&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;S3 bucket containing training data&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--output-bucket&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;S3 bucket for output artifacts&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--instance-type&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ml.m5.large&#39;</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;SageMaker instance type&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--hyperparameters&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;JSON string of hyperparameters&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    create_training_job(
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>job_name,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>data_bucket,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>output_bucket,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>instance_type,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>hyperparameters
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><h3 id="42-script-ƒë√°nh-gi√°-model">4.2 Script ƒë√°nh gi√° Model</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># aws/script/processing_evaluate.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> mean_squared_error, mean_absolute_error, r2_score
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate_model</span>(job_name, evaluation_data, baseline_metrics<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.85</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;ƒê√°nh gi√° model v√† so s√°nh v·ªõi baseline metrics&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T·∫°o th∆∞ m·ª•c cho plots</span>
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(<span style="color:#e6db74">&#39;plots&#39;</span>, exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sagemaker <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;sagemaker&#39;</span>)
</span></span><span style="display:flex;"><span>    s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># L·∫•y th√¥ng tin training job</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>describe_training_job(TrainingJobName<span style="color:#f92672">=</span>job_name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> response[<span style="color:#e6db74">&#39;TrainingJobStatus&#39;</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;Completed&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Training job </span><span style="color:#e6db74">{</span>job_name<span style="color:#e6db74">}</span><span style="color:#e6db74"> ch∆∞a ho√†n th√†nh&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    model_artifacts <span style="color:#f92672">=</span> response[<span style="color:#e6db74">&#39;ModelArtifacts&#39;</span>][<span style="color:#e6db74">&#39;S3ModelArtifacts&#39;</span>]
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Model artifacts: </span><span style="color:#e6db74">{</span>model_artifacts<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Download d·ªØ li·ªáu ƒë√°nh gi√° t·ª´ S3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> evaluation_data<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;s3://&#39;</span>):
</span></span><span style="display:flex;"><span>        bucket, key <span style="color:#f92672">=</span> evaluation_data<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;s3://&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        local_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;evaluation_data.csv&#39;</span>
</span></span><span style="display:flex;"><span>        s3<span style="color:#f92672">.</span>download_file(bucket, key, local_path)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        local_path <span style="color:#f92672">=</span> evaluation_data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Load d·ªØ li·ªáu ƒë√°nh gi√°</span>
</span></span><span style="display:flex;"><span>    eval_data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(local_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Trong d·ª± √°n th·ª±c t·∫ø, ·ªü ƒë√¢y s·∫Ω load model t·ª´ S3 v√† ƒë√°nh gi√°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># V√≠ d·ª• ƒë∆°n gi·∫£n n√†y gi·∫£ ƒë·ªãnh ch√∫ng ta ƒë√£ c√≥ k·∫øt qu·∫£ d·ª± ƒëo√°n</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Gi·∫£ ƒë·ªãnh k·∫øt qu·∫£ ƒë√°nh gi√°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Trong th·ª±c t·∫ø, b·∫°n s·∫Ω load model v√† th·ª±c hi·ªán d·ª± ƒëo√°n</span>
</span></span><span style="display:flex;"><span>    y_true <span style="color:#f92672">=</span> eval_data[<span style="color:#e6db74">&#39;target&#39;</span>]<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>    y_pred <span style="color:#f92672">=</span> y_true <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.9</span> <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.2</span>, size<span style="color:#f92672">=</span>y_true<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T√≠nh to√°n metrics</span>
</span></span><span style="display:flex;"><span>    metrics <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;mse&#39;</span>: mean_squared_error(y_true, y_pred),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;rmse&#39;</span>: np<span style="color:#f92672">.</span>sqrt(mean_squared_error(y_true, y_pred)),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;mae&#39;</span>: mean_absolute_error(y_true, y_pred),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;r2_score&#39;</span>: r2_score(y_true, y_pred),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;accuracy&#39;</span>: <span style="color:#ae81ff">0.88</span>  <span style="color:#75715e"># Gi·∫£ ƒë·ªãnh cho forecasting task</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># So s√°nh v·ªõi baseline metrics n·∫øu c√≥</span>
</span></span><span style="display:flex;"><span>    baseline <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> baseline_metrics:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> baseline_metrics<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;s3://&#39;</span>):
</span></span><span style="display:flex;"><span>            bucket, key <span style="color:#f92672">=</span> baseline_metrics<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;s3://&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            local_baseline <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;baseline_metrics.json&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                s3<span style="color:#f92672">.</span>download_file(bucket, key, local_baseline)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> open(local_baseline, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>                    baseline <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Kh√¥ng t√¨m th·∫•y baseline metrics: </span><span style="color:#e6db74">{</span>baseline_metrics<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> open(baseline_metrics, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>                    baseline <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Kh√¥ng t√¨m th·∫•y baseline metrics: </span><span style="color:#e6db74">{</span>baseline_metrics<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Quy·∫øt ƒë·ªãnh model c√≥ ƒë∆∞·ª£c ch·∫•p nh·∫≠n hay kh√¥ng</span>
</span></span><span style="display:flex;"><span>    approved <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> baseline:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;So s√°nh v·ªõi baseline:&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> metrics:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> baseline:
</span></span><span style="display:flex;"><span>                improvement <span style="color:#f92672">=</span> (metrics[key] <span style="color:#f92672">-</span> baseline[key]) <span style="color:#f92672">/</span> baseline[key] <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>metrics[key]<span style="color:#e6db74">:</span><span style="color:#e6db74">.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (baseline: </span><span style="color:#e6db74">{</span>baseline[key]<span style="color:#e6db74">:</span><span style="color:#e6db74">.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>improvement<span style="color:#e6db74">:</span><span style="color:#e6db74">+.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Ki·ªÉm tra ti√™u ch√≠ c·∫£i thi·ªán</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> key <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;accuracy&#39;</span> <span style="color:#f92672">and</span> metrics[key] <span style="color:#f92672">&lt;</span> threshold:
</span></span><span style="display:flex;"><span>                    approved <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> key <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;mse&#39;</span>, <span style="color:#e6db74">&#39;rmse&#39;</span>, <span style="color:#e6db74">&#39;mae&#39;</span>] <span style="color:#f92672">and</span> metrics[key] <span style="color:#f92672">&gt;</span> baseline[key] <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.1</span>:  <span style="color:#75715e"># Cho ph√©p t·ªá h∆°n 10%</span>
</span></span><span style="display:flex;"><span>                    approved <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Kh√¥ng c√≥ baseline ƒë·ªÉ so s√°nh&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T·∫°o visualizations</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>scatter(y_true, y_pred, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot([y_true<span style="color:#f92672">.</span>min(), y_true<span style="color:#f92672">.</span>max()], [y_true<span style="color:#f92672">.</span>min(), y_true<span style="color:#f92672">.</span>max()], <span style="color:#e6db74">&#39;r--&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Actual&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Predicted&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Actual vs Predicted Values&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;plots/actual_vs_predicted.png&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Residual plot</span>
</span></span><span style="display:flex;"><span>    residuals <span style="color:#f92672">=</span> y_true <span style="color:#f92672">-</span> y_pred
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>scatter(y_pred, residuals, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>hlines(y<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, xmin<span style="color:#f92672">=</span>y_pred<span style="color:#f92672">.</span>min(), xmax<span style="color:#f92672">=</span>y_pred<span style="color:#f92672">.</span>max(), colors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>, linestyles<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Predicted&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Residuals&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Residual Plot&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;plots/residuals.png&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># L∆∞u k·∫øt qu·∫£ ƒë√°nh gi√°</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;job_name&#39;</span>: job_name,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;metrics&#39;</span>: metrics,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;baseline&#39;</span>: baseline,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;approved&#39;</span>: approved,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;model_uri&#39;</span>: model_artifacts
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;evaluation_results.json&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        json<span style="color:#f92672">.</span>dump(result, f, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># L∆∞u k·∫øt qu·∫£ approved ƒë·ªÉ GitHub Actions c√≥ th·ªÉ ƒë·ªçc</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;model_approved.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>write(str(approved)<span style="color:#f92672">.</span>lower())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Model approved: </span><span style="color:#e6db74">{</span>approved<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> approved
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Evaluate trained model&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--job-name&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Name of the SageMaker training job&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--evaluation-data&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;S3 URI or local path to evaluation data&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--baseline-metrics&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;S3 URI or local path to baseline metrics&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--threshold&#39;</span>, type<span style="color:#f92672">=</span>float, default<span style="color:#f92672">=</span><span style="color:#ae81ff">0.85</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Accuracy threshold for model approval&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    evaluate_model(
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>job_name,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>evaluation_data,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>baseline_metrics,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>threshold
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><h3 id="43-script-ƒëƒÉng-k√Ω-model-registry">4.3 Script ƒëƒÉng k√Ω Model Registry</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># aws/script/register_model.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">register_model</span>(job_name, model_package_group, approval_status<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;PendingManualApproval&#39;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;ƒêƒÉng k√Ω model v√†o Model Registry&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sagemaker <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;sagemaker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Ki·ªÉm tra xem Model Package Group ƒë√£ t·ªìn t·∫°i ch∆∞a</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        sagemaker<span style="color:#f92672">.</span>describe_model_package_group(ModelPackageGroupName<span style="color:#f92672">=</span>model_package_group)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Model Package Group </span><span style="color:#e6db74">{</span>model_package_group<span style="color:#e6db74">}</span><span style="color:#e6db74"> ƒë√£ t·ªìn t·∫°i&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> sagemaker<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>ResourceNotFound:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;T·∫°o Model Package Group m·ªõi: </span><span style="color:#e6db74">{</span>model_package_group<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        sagemaker<span style="color:#f92672">.</span>create_model_package_group(
</span></span><span style="display:flex;"><span>            ModelPackageGroupName<span style="color:#f92672">=</span>model_package_group,
</span></span><span style="display:flex;"><span>            ModelPackageGroupDescription<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Retail Forecast Models&#34;</span>,
</span></span><span style="display:flex;"><span>            Tags<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>                {<span style="color:#e6db74">&#39;Key&#39;</span>: <span style="color:#e6db74">&#39;Project&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#e6db74">&#39;RetailForecast&#39;</span>}
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># L·∫•y th√¥ng tin training job</span>
</span></span><span style="display:flex;"><span>    training_job <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>describe_training_job(TrainingJobName<span style="color:#f92672">=</span>job_name)
</span></span><span style="display:flex;"><span>    model_data_url <span style="color:#f92672">=</span> training_job[<span style="color:#e6db74">&#39;ModelArtifacts&#39;</span>][<span style="color:#e6db74">&#39;S3ModelArtifacts&#39;</span>]
</span></span><span style="display:flex;"><span>    image_uri <span style="color:#f92672">=</span> training_job[<span style="color:#e6db74">&#39;AlgorithmSpecification&#39;</span>][<span style="color:#e6db74">&#39;TrainingImage&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ƒêƒÉng k√Ω model package</span>
</span></span><span style="display:flex;"><span>    model_package_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>model_package_group<span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">{</span>int(time<span style="color:#f92672">.</span>time())<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    create_model_package_input_dict <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;ModelPackageGroupName&#39;</span>: model_package_group,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;ModelPackageDescription&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Model trained by job </span><span style="color:#e6db74">{</span>job_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;InferenceSpecification&#39;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Containers&#39;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Image&#39;</span>: image_uri,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;ModelDataUrl&#39;</span>: model_data_url
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;SupportedContentTypes&#39;</span>: [<span style="color:#e6db74">&#39;text/csv&#39;</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;SupportedResponseMIMETypes&#39;</span>: [<span style="color:#e6db74">&#39;text/csv&#39;</span>]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;ModelApprovalStatus&#39;</span>: approval_status,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;CustomerMetadataProperties&#39;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;TrainingJobName&#39;</span>: job_name,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;CreatedBy&#39;</span>: <span style="color:#e6db74">&#39;GitHubActionsCI&#39;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Tags&#39;</span>: [
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#39;Key&#39;</span>: <span style="color:#e6db74">&#39;Project&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#e6db74">&#39;RetailForecast&#39;</span>}
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Th√™m model metrics n·∫øu c√≥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;evaluation_results.json&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>            eval_results <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        model_metrics <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> metric_name, value <span style="color:#f92672">in</span> eval_results<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;metrics&#39;</span>, {})<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>            model_metrics<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Name&#39;</span>: metric_name,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Value&#39;</span>: float(value)
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> model_metrics:
</span></span><span style="display:flex;"><span>            create_model_package_input_dict[<span style="color:#e6db74">&#39;ModelMetrics&#39;</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;ModelQuality&#39;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Statistics&#39;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;ContentType&#39;</span>: <span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Values&#39;</span>: model_metrics
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Kh√¥ng th·ªÉ ƒë·ªçc k·∫øt qu·∫£ ƒë√°nh gi√°: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>create_model_package(<span style="color:#f92672">**</span>create_model_package_input_dict)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Model package ƒë√£ ƒë∆∞·ª£c t·∫°o: </span><span style="color:#e6db74">{</span>response[<span style="color:#e6db74">&#39;ModelPackageArn&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># L·∫•y version t·ª´ ARN</span>
</span></span><span style="display:flex;"><span>    model_version <span style="color:#f92672">=</span> response[<span style="color:#e6db74">&#39;ModelPackageArn&#39;</span>]<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;/&#39;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Model version: </span><span style="color:#e6db74">{</span>model_version<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> model_version
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Register model to SageMaker Model Registry&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--job-name&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Name of the training job&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--model-package-group&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Model package group name&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--approval-status&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;PendingManualApproval&#39;</span>,
</span></span><span style="display:flex;"><span>                        choices<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Approved&#39;</span>, <span style="color:#e6db74">&#39;Rejected&#39;</span>, <span style="color:#e6db74">&#39;PendingManualApproval&#39;</span>],
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Initial model approval status&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    model_version <span style="color:#f92672">=</span> register_model(
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>job_name,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>model_package_group,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>approval_status
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(model_version)
</span></span></code></pre></div><h3 id="44-script-tri·ªÉn-khai-endpoint">4.4 Script tri·ªÉn khai Endpoint</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># aws/script/deploy_endpoint.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> uuid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">deploy_endpoint</span>(model_package_arn, endpoint_name, instance_type, instance_count<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Deploy model to SageMaker endpoint&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sagemaker <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;sagemaker&#39;</span>)
</span></span><span style="display:flex;"><span>    timestamp <span style="color:#f92672">=</span> int(time<span style="color:#f92672">.</span>time())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T·∫°o model</span>
</span></span><span style="display:flex;"><span>    model_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74">-model-</span><span style="color:#e6db74">{</span>timestamp<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Creating model </span><span style="color:#e6db74">{</span>model_name<span style="color:#e6db74">}</span><span style="color:#e6db74"> from </span><span style="color:#e6db74">{</span>model_package_arn<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    model_response <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>create_model(
</span></span><span style="display:flex;"><span>        ModelName<span style="color:#f92672">=</span>model_name,
</span></span><span style="display:flex;"><span>        PrimaryContainer<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;ModelPackageName&#39;</span>: model_package_arn
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        ExecutionRoleArn<span style="color:#f92672">=</span>sagemaker<span style="color:#f92672">.</span>get_caller_identity()[<span style="color:#e6db74">&#39;RoleArn&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T·∫°o endpoint config</span>
</span></span><span style="display:flex;"><span>    config_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74">-config-</span><span style="color:#e6db74">{</span>timestamp<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Creating endpoint config </span><span style="color:#e6db74">{</span>config_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    endpoint_config_response <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>create_endpoint_config(
</span></span><span style="display:flex;"><span>        EndpointConfigName<span style="color:#f92672">=</span>config_name,
</span></span><span style="display:flex;"><span>        ProductionVariants<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;VariantName&#39;</span>: <span style="color:#e6db74">&#39;default&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;ModelName&#39;</span>: model_name,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;InstanceType&#39;</span>: instance_type,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;InitialInstanceCount&#39;</span>: instance_count,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;InitialVariantWeight&#39;</span>: <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        Tags<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#39;Key&#39;</span>: <span style="color:#e6db74">&#39;Project&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#e6db74">&#39;RetailForecast&#39;</span>}
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Ki·ªÉm tra xem endpoint ƒë√£ t·ªìn t·∫°i ch∆∞a</span>
</span></span><span style="display:flex;"><span>    endpoint_exists <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>describe_endpoint(EndpointName<span style="color:#f92672">=</span>endpoint_name)
</span></span><span style="display:flex;"><span>        endpoint_exists <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> sagemaker<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>ClientError:
</span></span><span style="display:flex;"><span>        endpoint_exists <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T·∫°o ho·∫∑c c·∫≠p nh·∫≠t endpoint</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> endpoint_exists:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Updating endpoint </span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        endpoint_response <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>update_endpoint(
</span></span><span style="display:flex;"><span>            EndpointName<span style="color:#f92672">=</span>endpoint_name,
</span></span><span style="display:flex;"><span>            EndpointConfigName<span style="color:#f92672">=</span>config_name
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Creating endpoint </span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        endpoint_response <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>create_endpoint(
</span></span><span style="display:flex;"><span>            EndpointName<span style="color:#f92672">=</span>endpoint_name,
</span></span><span style="display:flex;"><span>            EndpointConfigName<span style="color:#f92672">=</span>config_name,
</span></span><span style="display:flex;"><span>            Tags<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>                {<span style="color:#e6db74">&#39;Key&#39;</span>: <span style="color:#e6db74">&#39;Project&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#e6db74">&#39;RetailForecast&#39;</span>}
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ƒê·ª£i endpoint s·∫µn s√†ng</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Waiting for endpoint </span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74"> to be in service...&#34;</span>)
</span></span><span style="display:flex;"><span>    waiter <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>get_waiter(<span style="color:#e6db74">&#39;endpoint_in_service&#39;</span>)
</span></span><span style="display:flex;"><span>    waiter<span style="color:#f92672">.</span>wait(EndpointName<span style="color:#f92672">=</span>endpoint_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># L·∫•y th√¥ng tin endpoint</span>
</span></span><span style="display:flex;"><span>    endpoint_info <span style="color:#f92672">=</span> sagemaker<span style="color:#f92672">.</span>describe_endpoint(EndpointName<span style="color:#f92672">=</span>endpoint_name)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Endpoint </span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74"> is ready (status: </span><span style="color:#e6db74">{</span>endpoint_info[<span style="color:#e6db74">&#39;EndpointStatus&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;endpoint_name&#39;</span>: endpoint_name,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;endpoint_arn&#39;</span>: endpoint_info[<span style="color:#e6db74">&#39;EndpointArn&#39;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;status&#39;</span>: endpoint_info[<span style="color:#e6db74">&#39;EndpointStatus&#39;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Deploy model to SageMaker endpoint&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--model-package-arn&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ARN of model package to deploy&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--endpoint-name&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Name of the endpoint&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--instance-type&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ml.t2.medium&#39;</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Instance type for inference&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--instance-count&#39;</span>, type<span style="color:#f92672">=</span>int, default<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                        help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Number of instances&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> deploy_endpoint(
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>model_package_arn,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>endpoint_name,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>instance_type,
</span></span><span style="display:flex;"><span>        args<span style="color:#f92672">.</span>instance_count
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Endpoint deployment complete: </span><span style="color:#e6db74">{</span>result<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><h3 id="45-script-ki·ªÉm-tra-hi·ªáu-su·∫•t-endpoint">4.5 Script ki·ªÉm tra hi·ªáu su·∫•t Endpoint</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># aws/script/autoscaling_endpoint.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setup_autoscaling</span>(endpoint_name, min_capacity<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, max_capacity<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>                      target_value<span style="color:#f92672">=</span><span style="color:#ae81ff">70.0</span>, scale_in_cooldown<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>,
</span></span><span style="display:flex;"><span>                      scale_out_cooldown<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Thi·∫øt l·∫≠p autoscaling cho SageMaker endpoint&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># L·∫•y variant name v√† ARN c·ªßa endpoint</span>
</span></span><span style="display:flex;"><span>    sm <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;sagemaker&#39;</span>)
</span></span><span style="display:flex;"><span>    endpoint <span style="color:#f92672">=</span> sm<span style="color:#f92672">.</span>describe_endpoint(EndpointName<span style="color:#f92672">=</span>endpoint_name)
</span></span><span style="display:flex;"><span>    endpoint_arn <span style="color:#f92672">=</span> endpoint[<span style="color:#e6db74">&#39;EndpointArn&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    config_name <span style="color:#f92672">=</span> endpoint[<span style="color:#e6db74">&#39;EndpointConfigName&#39;</span>]
</span></span><span style="display:flex;"><span>    config <span style="color:#f92672">=</span> sm<span style="color:#f92672">.</span>describe_endpoint_config(EndpointConfigName<span style="color:#f92672">=</span>config_name)
</span></span><span style="display:flex;"><span>    variant_name <span style="color:#f92672">=</span> config[<span style="color:#e6db74">&#39;ProductionVariants&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;VariantName&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Chu·∫©n b·ªã resource ID cho autoscaling</span>
</span></span><span style="display:flex;"><span>    resource_id <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;endpoint/</span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74">/variant/</span><span style="color:#e6db74">{</span>variant_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Thi·∫øt l·∫≠p application autoscaling</span>
</span></span><span style="display:flex;"><span>    aas <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;application-autoscaling&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ƒêƒÉng k√Ω scalable target</span>
</span></span><span style="display:flex;"><span>    aas<span style="color:#f92672">.</span>register_scalable_target(
</span></span><span style="display:flex;"><span>        ServiceNamespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sagemaker&#39;</span>,
</span></span><span style="display:flex;"><span>        ResourceId<span style="color:#f92672">=</span>resource_id,
</span></span><span style="display:flex;"><span>        ScalableDimension<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sagemaker:variant:DesiredInstanceCount&#39;</span>,
</span></span><span style="display:flex;"><span>        MinCapacity<span style="color:#f92672">=</span>min_capacity,
</span></span><span style="display:flex;"><span>        MaxCapacity<span style="color:#f92672">=</span>max_capacity
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T·∫°o scaling policy</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> aas<span style="color:#f92672">.</span>put_scaling_policy(
</span></span><span style="display:flex;"><span>        PolicyName<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74">-scaling-policy&#34;</span>,
</span></span><span style="display:flex;"><span>        ServiceNamespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sagemaker&#39;</span>,
</span></span><span style="display:flex;"><span>        ResourceId<span style="color:#f92672">=</span>resource_id,
</span></span><span style="display:flex;"><span>        ScalableDimension<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sagemaker:variant:DesiredInstanceCount&#39;</span>,
</span></span><span style="display:flex;"><span>        PolicyType<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;TargetTrackingScaling&#39;</span>,
</span></span><span style="display:flex;"><span>        TargetTrackingScalingPolicyConfiguration<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;TargetValue&#39;</span>: target_value,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;PredefinedMetricSpecification&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;PredefinedMetricType&#39;</span>: <span style="color:#e6db74">&#39;SageMakerVariantInvocationsPerInstance&#39;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;ScaleInCooldown&#39;</span>: scale_in_cooldown,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;ScaleOutCooldown&#39;</span>: scale_out_cooldown
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Autoscaling configured for endpoint </span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Min capacity: </span><span style="color:#e6db74">{</span>min_capacity<span style="color:#e6db74">}</span><span style="color:#e6db74">, Max capacity: </span><span style="color:#e6db74">{</span>max_capacity<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Target value: </span><span style="color:#e6db74">{</span>target_value<span style="color:#e6db74">}</span><span style="color:#e6db74"> invocations per instance&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;endpoint_name&#39;</span>: endpoint_name,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;resource_id&#39;</span>: resource_id,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;scaling_policy_arn&#39;</span>: response[<span style="color:#e6db74">&#39;PolicyARN&#39;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_test_endpoint</span>(endpoint_name, test_data_path, duration<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>, rate<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test t·∫£i endpoint ƒë·ªÉ ki·ªÉm tra hi·ªáu su·∫•t v√† autoscaling&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sagemaker_runtime <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;sagemaker-runtime&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Load test data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(test_data_path, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        test_data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># N·∫øu test data l√† list, l·∫•y ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> isinstance(test_data, list):
</span></span><span style="display:flex;"><span>        sample <span style="color:#f92672">=</span> test_data[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        sample <span style="color:#f92672">=</span> test_data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Chu·∫©n b·ªã test</span>
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    end_time <span style="color:#f92672">=</span> start_time <span style="color:#f92672">+</span> duration
</span></span><span style="display:flex;"><span>    request_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    success_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    latencies <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Starting load test on endpoint </span><span style="color:#e6db74">{</span>endpoint_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Duration: </span><span style="color:#e6db74">{</span>duration<span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds, Rate: </span><span style="color:#e6db74">{</span>rate<span style="color:#e6db74">}</span><span style="color:#e6db74"> requests/second&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Th·ª±c hi·ªán load test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">&lt;</span> end_time:
</span></span><span style="display:flex;"><span>        batch_start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(rate):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">&gt;=</span> end_time:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># G·ª≠i request</span>
</span></span><span style="display:flex;"><span>                request_start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>                response <span style="color:#f92672">=</span> sagemaker_runtime<span style="color:#f92672">.</span>invoke_endpoint(
</span></span><span style="display:flex;"><span>                    EndpointName<span style="color:#f92672">=</span>endpoint_name,
</span></span><span style="display:flex;"><span>                    ContentType<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>                    Body<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(sample)
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># ƒêo latency</span>
</span></span><span style="display:flex;"><span>                latency <span style="color:#f92672">=</span> (time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> request_start) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>  <span style="color:#75715e"># milliseconds</span>
</span></span><span style="display:flex;"><span>                latencies<span style="color:#f92672">.</span>append(latency)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># ƒê·ªçc k·∫øt qu·∫£</span>
</span></span><span style="display:flex;"><span>                result <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response[<span style="color:#e6db74">&#39;Body&#39;</span>]<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># C·∫≠p nh·∫≠t counter</span>
</span></span><span style="display:flex;"><span>                request_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                success_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> request_count <span style="color:#f92672">%</span> <span style="color:#ae81ff">50</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Processed </span><span style="color:#e6db74">{</span>request_count<span style="color:#e6db74">}</span><span style="color:#e6db74"> requests...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                request_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error invoking endpoint: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ƒê·ª£i ƒë·∫øn ƒë·∫ßu gi√¢y ti·∫øp theo</span>
</span></span><span style="display:flex;"><span>        elapsed <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> batch_start
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> elapsed <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1.0</span>:
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> elapsed)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># T√≠nh to√°n k·∫øt qu·∫£</span>
</span></span><span style="display:flex;"><span>    total_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time
</span></span><span style="display:flex;"><span>    avg_rate <span style="color:#f92672">=</span> request_count <span style="color:#f92672">/</span> total_time
</span></span><span style="display:flex;"><span>    success_rate <span style="color:#f92672">=</span> (success_count <span style="color:#f92672">/</span> request_count) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span> <span style="color:#66d9ef">if</span> request_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> latencies:
</span></span><span style="display:flex;"><span>        avg_latency <span style="color:#f92672">=</span> sum(latencies) <span style="color:#f92672">/</span> len(latencies)
</span></span><span style="display:flex;"><span>        min_latency <span style="color:#f92672">=</span> min(latencies)
</span></span><span style="display:flex;"><span>        max_latency <span style="color:#f92672">=</span> max(latencies)
</span></span><span style="display:flex;"><span>        p95_latency <span style="color:#f92672">=</span> sorted(latencies)[int(len(latencies) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.95</span>)]
</span></span><span style="display:flex;"><span>        p99_latency <span style="color:#f92672">=</span> sorted(latencies)[int(len(latencies) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.99</span>)]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        avg_latency <span style="color:#f92672">=</span> min_latency <span style="color:#f92672">=</span> max_latency <span style="color:#f92672">=</span> p95_latency <span style="color:#f92672">=</span> p99_latency <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># In k·∫øt qu·∫£</span>
</span></span><span style="display:flex;"><span>    results <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;endpoint&#39;</span>: endpoint_name,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;duration_seconds&#39;</span>: total_time,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;request_count&#39;</span>: request_count,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;success_count&#39;</span>: success_count,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;success_rate_percent&#39;</span>: success_rate,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;avg_requests_per_second&#39;</span>: avg_rate,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;latency_ms&#39;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;avg&#39;</span>: avg_latency,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;min&#39;</span>: min_latency,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;max&#39;</span>: max_latency,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;p95&#39;</span>: p95_latency,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;p99&#39;</span>: p99_latency
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Load Test Results:&#34;</span>)
</span></span><span style="display:flex;"><span>    print(json<span style="color:#f92672">.</span>dumps(results, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;load_test_results.json&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        json<span style="color:#f92672">.</span>dump(results, f, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Setup autoscaling and test SageMaker endpoint&#39;</span>)
</span></span><span style="display:flex;"><span>    subparsers <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>add_subparsers(dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;command&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Subparser cho autoscaling</span>
</span></span><span style="display:flex;"><span>    autoscaling_parser <span style="color:#f92672">=</span> subparsers<span style="color:#f92672">.</span>add_parser(<span style="color:#e6db74">&#39;autoscale&#39;</span>)
</span></span><span style="display:flex;"><span>    autoscaling_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--endpoint-name&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    autoscaling_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--min-capacity&#39;</span>, type<span style="color:#f92672">=</span>int, default<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    autoscaling_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--max-capacity&#39;</span>, type<span style="color:#f92672">=</span>int, default<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>    autoscaling_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--target-value&#39;</span>, type<span style="color:#f92672">=</span>float, default<span style="color:#f92672">=</span><span style="color:#ae81ff">70.0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Subparser cho load testing</span>
</span></span><span style="display:flex;"><span>    loadtest_parser <span style="color:#f92672">=</span> subparsers<span style="color:#f92672">.</span>add_parser(<span style="color:#e6db74">&#39;loadtest&#39;</span>)
</span></span><span style="display:flex;"><span>    loadtest_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--endpoint-name&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    loadtest_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--test-data&#39;</span>, type<span style="color:#f92672">=</span>str, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    loadtest_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--duration&#39;</span>, type<span style="color:#f92672">=</span>int, default<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span>    loadtest_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--rate&#39;</span>, type<span style="color:#f92672">=</span>int, default<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>command <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;autoscale&#39;</span>:
</span></span><span style="display:flex;"><span>        setup_autoscaling(
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>endpoint_name,
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>min_capacity,
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>max_capacity,
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>target_value
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> args<span style="color:#f92672">.</span>command <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;loadtest&#39;</span>:
</span></span><span style="display:flex;"><span>        load_test_endpoint(
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>endpoint_name,
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>test_data,
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>duration,
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">.</span>rate
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>print_help()
</span></span></code></pre></div><h2 id="5-gi√°m-s√°t-v√†-th√¥ng-b√°o">5. Gi√°m s√°t v√† Th√¥ng b√°o</h2>
<h3 id="51-thi·∫øt-l·∫≠p-sns-topic">5.1 Thi·∫øt l·∫≠p SNS Topic</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># T·∫°o SNS topic cho th√¥ng b√°o deployment</span>
</span></span><span style="display:flex;"><span>aws sns create-topic --name retail-forecast-alerts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ƒêƒÉng k√Ω email nh·∫≠n th√¥ng b√°o</span>
</span></span><span style="display:flex;"><span>aws sns subscribe <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --topic-arn arn:aws:sns:us-east-1:&lt;ACCOUNT_ID&gt;:retail-forecast-alerts <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --protocol email <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --notification-endpoint team@example.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ƒêƒÉng k√Ω webhook Slack</span>
</span></span><span style="display:flex;"><span>aws sns subscribe <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --topic-arn arn:aws:sns:us-east-1:&lt;ACCOUNT_ID&gt;:retail-forecast-alerts <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --protocol https <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --notification-endpoint https://hooks.slack.com/services/XXXX/YYYY/ZZZZ
</span></span></code></pre></div><h3 id="52-cloudwatch-dashboard-cho-cicd-pipeline">5.2 CloudWatch Dashboard cho CI/CD Pipeline</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># T·∫°o CloudWatch dashboard cho pipeline</span>
</span></span><span style="display:flex;"><span>aws cloudwatch put-dashboard <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dashboard-name RetailForecast-CI-CD-Pipeline <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dashboard-body <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;widgets&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;type&#34;: &#34;metric&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;x&#34;: 0,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;y&#34;: 0,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;width&#34;: 12,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;height&#34;: 6,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;properties&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;metrics&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;AWS/SageMaker&#34;, &#34;TrainingJobsCompleted&#34;, { &#34;stat&#34;: &#34;Sum&#34;, &#34;period&#34;: 86400 } ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;AWS/SageMaker&#34;, &#34;TrainingJobsFailed&#34;, { &#34;stat&#34;: &#34;Sum&#34;, &#34;period&#34;: 86400 } ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;view&#34;: &#34;timeSeries&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;stacked&#34;: false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;region&#34;: &#34;us-east-1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;title&#34;: &#34;SageMaker Training Jobs&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;period&#34;: 300,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;stat&#34;: &#34;Sum&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;type&#34;: &#34;metric&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;x&#34;: 12,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;y&#34;: 0,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;width&#34;: 12,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;height&#34;: 6,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;properties&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;metrics&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;AWS/ApplicationELB&#34;, &#34;TargetResponseTime&#34;, &#34;LoadBalancer&#34;, &#34;app/retail-forecast/abcdef&#34; ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;.&#34;, &#34;HTTPCode_Target_5XX_Count&#34;, &#34;.&#34;, &#34;.&#34; ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;.&#34;, &#34;HTTPCode_Target_4XX_Count&#34;, &#34;.&#34;, &#34;.&#34; ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;view&#34;: &#34;timeSeries&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;stacked&#34;: false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;region&#34;: &#34;us-east-1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;title&#34;: &#34;API Performance&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;period&#34;: 300,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;stat&#34;: &#34;Average&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;type&#34;: &#34;metric&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;x&#34;: 0,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;y&#34;: 6,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;width&#34;: 12,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;height&#34;: 6,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;properties&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;metrics&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;AWS/SageMaker&#34;, &#34;Invocations&#34;, &#34;EndpointName&#34;, &#34;retail-forecast-prod&#34;, { &#34;stat&#34;: &#34;Sum&#34;, &#34;period&#34;: 60 } ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;.&#34;, &#34;InvocationsPerInstance&#34;, &#34;.&#34;, &#34;.&#34; ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;view&#34;: &#34;timeSeries&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;stacked&#34;: false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;region&#34;: &#34;us-east-1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;title&#34;: &#34;SageMaker Endpoint Invocations&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;period&#34;: 300
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;type&#34;: &#34;metric&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;x&#34;: 12,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;y&#34;: 6,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;width&#34;: 12,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;height&#34;: 6,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;properties&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;metrics&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;RetailForecast/Pipeline&#34;, &#34;DeploymentFrequency&#34; ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;.&#34;, &#34;FailureRate&#34; ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    [ &#34;.&#34;, &#34;LeadTime&#34; ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;view&#34;: &#34;timeSeries&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;stacked&#34;: false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;region&#34;: &#34;us-east-1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;title&#34;: &#34;CI/CD Metrics&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;period&#34;: 86400,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;stat&#34;: &#34;Average&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span></code></pre></div><h3 id="53-c·∫•u-h√¨nh-pipeline-metrics">5.3 C·∫•u h√¨nh Pipeline Metrics</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># aws/script/pipeline_metrics.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">publish_pipeline_metrics</span>(deploy_success<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, lead_time<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Publish CI/CD pipeline metrics to CloudWatch&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cloudwatch <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;cloudwatch&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get date parts for daily metrics</span>
</span></span><span style="display:flex;"><span>    now <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>    today <span style="color:#f92672">=</span> now<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Increment deployment count</span>
</span></span><span style="display:flex;"><span>    cloudwatch<span style="color:#f92672">.</span>put_metric_data(
</span></span><span style="display:flex;"><span>        Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RetailForecast/Pipeline&#39;</span>,
</span></span><span style="display:flex;"><span>        MetricData<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;MetricName&#39;</span>: <span style="color:#e6db74">&#39;DeploymentCount&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Dimensions&#39;</span>: [
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Name&#39;</span>: <span style="color:#e6db74">&#39;Date&#39;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Value&#39;</span>: today
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                ],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Unit&#39;</span>: <span style="color:#e6db74">&#39;Count&#39;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Add deployment success/failure</span>
</span></span><span style="display:flex;"><span>    cloudwatch<span style="color:#f92672">.</span>put_metric_data(
</span></span><span style="display:flex;"><span>        Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RetailForecast/Pipeline&#39;</span>,
</span></span><span style="display:flex;"><span>        MetricData<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;MetricName&#39;</span>: <span style="color:#e6db74">&#39;DeploymentSuccess&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Dimensions&#39;</span>: [
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Name&#39;</span>: <span style="color:#e6db74">&#39;Date&#39;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Value&#39;</span>: today
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                ],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#ae81ff">1.0</span> <span style="color:#66d9ef">if</span> deploy_success <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Unit&#39;</span>: <span style="color:#e6db74">&#39;Count&#39;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Add lead time if provided</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> lead_time <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        cloudwatch<span style="color:#f92672">.</span>put_metric_data(
</span></span><span style="display:flex;"><span>            Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RetailForecast/Pipeline&#39;</span>,
</span></span><span style="display:flex;"><span>            MetricData<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;MetricName&#39;</span>: <span style="color:#e6db74">&#39;LeadTimeMinutes&#39;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Dimensions&#39;</span>: [
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#39;Name&#39;</span>: <span style="color:#e6db74">&#39;Date&#39;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#39;Value&#39;</span>: today
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    ],
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Value&#39;</span>: lead_time,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Unit&#39;</span>: <span style="color:#e6db74">&#39;Minutes&#39;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Pipeline metrics published successfully&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calculate_pipeline_kpis</span>(days<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Calculate KPIs for CI/CD pipeline&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cloudwatch <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;cloudwatch&#39;</span>)
</span></span><span style="display:flex;"><span>    end_time <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> end_time <span style="color:#f92672">-</span> timedelta(days<span style="color:#f92672">=</span>days)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get deployment frequency</span>
</span></span><span style="display:flex;"><span>    deploy_count_response <span style="color:#f92672">=</span> cloudwatch<span style="color:#f92672">.</span>get_metric_statistics(
</span></span><span style="display:flex;"><span>        Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RetailForecast/Pipeline&#39;</span>,
</span></span><span style="display:flex;"><span>        MetricName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;DeploymentCount&#39;</span>,
</span></span><span style="display:flex;"><span>        StartTime<span style="color:#f92672">=</span>start_time,
</span></span><span style="display:flex;"><span>        EndTime<span style="color:#f92672">=</span>end_time,
</span></span><span style="display:flex;"><span>        Period<span style="color:#f92672">=</span><span style="color:#ae81ff">86400</span> <span style="color:#f92672">*</span> days,  <span style="color:#75715e"># entire period</span>
</span></span><span style="display:flex;"><span>        Statistics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get deployment success/failure</span>
</span></span><span style="display:flex;"><span>    deploy_success_response <span style="color:#f92672">=</span> cloudwatch<span style="color:#f92672">.</span>get_metric_statistics(
</span></span><span style="display:flex;"><span>        Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RetailForecast/Pipeline&#39;</span>,
</span></span><span style="display:flex;"><span>        MetricName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;DeploymentSuccess&#39;</span>,
</span></span><span style="display:flex;"><span>        StartTime<span style="color:#f92672">=</span>start_time,
</span></span><span style="display:flex;"><span>        EndTime<span style="color:#f92672">=</span>end_time,
</span></span><span style="display:flex;"><span>        Period<span style="color:#f92672">=</span><span style="color:#ae81ff">86400</span> <span style="color:#f92672">*</span> days,  <span style="color:#75715e"># entire period</span>
</span></span><span style="display:flex;"><span>        Statistics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get lead time</span>
</span></span><span style="display:flex;"><span>    lead_time_response <span style="color:#f92672">=</span> cloudwatch<span style="color:#f92672">.</span>get_metric_statistics(
</span></span><span style="display:flex;"><span>        Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RetailForecast/Pipeline&#39;</span>,
</span></span><span style="display:flex;"><span>        MetricName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;LeadTimeMinutes&#39;</span>,
</span></span><span style="display:flex;"><span>        StartTime<span style="color:#f92672">=</span>start_time,
</span></span><span style="display:flex;"><span>        EndTime<span style="color:#f92672">=</span>end_time,
</span></span><span style="display:flex;"><span>        Period<span style="color:#f92672">=</span><span style="color:#ae81ff">86400</span> <span style="color:#f92672">*</span> days,  <span style="color:#75715e"># entire period</span>
</span></span><span style="display:flex;"><span>        Statistics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Average&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Calculate KPIs</span>
</span></span><span style="display:flex;"><span>    deploy_count <span style="color:#f92672">=</span> deploy_count_response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;Sum&#39;</span>] <span style="color:#66d9ef">if</span> deploy_count_response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>] <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    deploy_success <span style="color:#f92672">=</span> deploy_success_response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;Sum&#39;</span>] <span style="color:#66d9ef">if</span> deploy_success_response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>] <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Calculate metrics</span>
</span></span><span style="display:flex;"><span>    deployments_per_day <span style="color:#f92672">=</span> deploy_count <span style="color:#f92672">/</span> days <span style="color:#66d9ef">if</span> days <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    failure_rate <span style="color:#f92672">=</span> (deploy_count <span style="color:#f92672">-</span> deploy_success) <span style="color:#f92672">/</span> deploy_count <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span> <span style="color:#66d9ef">if</span> deploy_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    avg_lead_time <span style="color:#f92672">=</span> lead_time_response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;Average&#39;</span>] <span style="color:#66d9ef">if</span> lead_time_response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>] <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    kpis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;period_days&#39;</span>: days,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;total_deployments&#39;</span>: deploy_count,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;successful_deployments&#39;</span>: deploy_success,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;deployments_per_day&#39;</span>: deployments_per_day,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;failure_rate_percent&#39;</span>: failure_rate,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;avg_lead_time_minutes&#39;</span>: avg_lead_time
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(json<span style="color:#f92672">.</span>dumps(kpis, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> kpis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Manage CI/CD pipeline metrics&#39;</span>)
</span></span><span style="display:flex;"><span>    subparsers <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>add_subparsers(dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;command&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Subparser cho publish metrics</span>
</span></span><span style="display:flex;"><span>    publish_parser <span style="color:#f92672">=</span> subparsers<span style="color:#f92672">.</span>add_parser(<span style="color:#e6db74">&#39;publish&#39;</span>)
</span></span><span style="display:flex;"><span>    publish_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--success&#39;</span>, type<span style="color:#f92672">=</span>bool, default<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    publish_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--lead-time&#39;</span>, type<span style="color:#f92672">=</span>float, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Lead time in minutes&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Subparser cho calculate KPIs</span>
</span></span><span style="display:flex;"><span>    kpi_parser <span style="color:#f92672">=</span> subparsers<span style="color:#f92672">.</span>add_parser(<span style="color:#e6db74">&#39;kpi&#39;</span>)
</span></span><span style="display:flex;"><span>    kpi_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--days&#39;</span>, type<span style="color:#f92672">=</span>int, default<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>command <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;publish&#39;</span>:
</span></span><span style="display:flex;"><span>        publish_pipeline_metrics(args<span style="color:#f92672">.</span>success, args<span style="color:#f92672">.</span>lead_time)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> args<span style="color:#f92672">.</span>command <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;kpi&#39;</span>:
</span></span><span style="display:flex;"><span>        calculate_pipeline_kpis(args<span style="color:#f92672">.</span>days)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>print_help()
</span></span></code></pre></div><h2 id="6-ki·ªÉm-tra-v√†-x√°c-th·ª±c">6. Ki·ªÉm tra v√† X√°c th·ª±c</h2>
<h3 id="61-checklist-ho√†n-th√†nh">6.1 Checklist Ho√†n th√†nh</h3>
<p>C√°c th√†nh ph·∫ßn ch√≠nh ƒë√£ tri·ªÉn khai:</p>
<ul>
<li><strong>Pipeline GitHub Actions</strong>: Workflow ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh v·ªõi c√°c job ƒë·∫ßy ƒë·ªß</li>
<li><strong>IAM Role &amp; Permissions</strong>: Role cho GitHub Actions v·ªõi OIDC x√°c th·ª±c</li>
<li><strong>Automated Testing</strong>: Unit tests, code quality check, data validation</li>
<li><strong>Model Training</strong>: T·ª± ƒë·ªông trigger SageMaker training jobs</li>
<li><strong>Model Evaluation &amp; Registry</strong>: ƒê√°nh gi√° model v√† ƒëƒÉng k√Ω v√†o Model Registry</li>
<li><strong>Docker Build</strong>: T·ª± ƒë·ªông build v√† push image l√™n ECR</li>
<li><strong>EKS Deployment</strong>: T·ª± ƒë·ªông c·∫≠p nh·∫≠t Kubernetes deployment</li>
<li><strong>Health Check</strong>: Ki·ªÉm tra v√† x√°c nh·∫≠n API ho·∫°t ƒë·ªông sau deployment</li>
<li><strong>CloudWatch Alarms</strong>: T·ª± ƒë·ªông c·∫•u h√¨nh alert cho deployment m·ªõi</li>
<li><strong>Notifications</strong>: Th√¥ng b√°o k·∫øt qu·∫£ deployment qua SNS</li>
<li><strong>GitHub Actions Pipeline</strong>: Workflows configured with full jobs</li>
<li><strong>IAM Role &amp; Permissions</strong>: Role for GitHub Actions with OIDC authentication</li>
<li><strong>Automated Testing</strong>: Unit tests, code quality checks, data validation</li>
<li><strong>Model Training</strong>: Automatically trigger SageMaker training jobs</li>
<li><strong>Model Evaluation &amp; Registry</strong>: Evaluate models and register to the Model Registry</li>
<li><strong>Docker Build</strong>: Automatically build and push images to ECR</li>
<li><strong>EKS Deployment</strong>: Automatically update Kubernetes deployments</li>
<li><strong>Health Check</strong>: Verify API health after deployment</li>
<li><strong>CloudWatch Alarms</strong>: Automatically configure alerts for new deployments</li>
<li><strong>Notifications</strong>: Deployment results notified via SNS</li>
</ul>
<h3 id="62-pipeline-testing">6.2 Pipeline Testing</h3>
<p>To verify the pipeline operates correctly, perform the following steps:</p>
<ol>
<li><strong>Trigger the pipeline by pushing a new commit</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Create a test commit to trigger the CI/CD pipeline</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;# Test CI/CD pipeline&#34;</span> &gt;&gt; README.md
</span></span><span style="display:flex;"><span>git add README.md
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#e6db74">&#34;Test: Trigger CI/CD pipeline&#34;</span>
</span></span><span style="display:flex;"><span>git push origin main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># Ki·ªÉm tra GitHub Actions</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># Pipeline s·∫Ω t·ª± ƒë·ªông k√≠ch ho·∫°t trong v√≤ng 1 ph√∫t</span>
</span></span></code></pre></div><ol start="2">
<li>
<p><strong>K√≠ch ho·∫°t pipeline th·ªß c√¥ng v·ªõi hu·∫•n luy·ªán model</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># S·ª≠ d·ª•ng GitHub UI ƒë·ªÉ k√≠ch ho·∫°t workflow v·ªõi c√°c t√πy ch·ªçn:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - environment: prod</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - retrain_model: true</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Ki·ªÉm tra ECR repository</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra image m·ªõi tr√™n ECR</span>
</span></span><span style="display:flex;"><span>aws ecr describe-images <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --repository-name retail-forecast <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;sort_by(imageDetails,&amp; imagePushedAt)[-5:]&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra tag m·ªõi nh·∫•t</span>
</span></span><span style="display:flex;"><span>aws ecr list-images <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --repository-name retail-forecast <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --filter <span style="color:#e6db74">&#34;tagStatus=TAGGED&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;imageIds[?contains(imageTag, `latest`)]&#39;</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Ki·ªÉm tra SageMaker model v√† deployment</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra training job m·ªõi nh·∫•t</span>
</span></span><span style="display:flex;"><span>aws sagemaker list-training-jobs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --sort-by CreationTime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --sort-order Descending <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-items <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra model package m·ªõi nh·∫•t</span>
</span></span><span style="display:flex;"><span>aws sagemaker list-model-packages <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --model-package-group-name retail-forecast-models <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --sort-by CreationTime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --sort-order Descending <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-items <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra endpoint</span>
</span></span><span style="display:flex;"><span>aws sagemaker describe-endpoint <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --endpoint-name retail-forecast-prod
</span></span></code></pre></div></li>
<li>
<p><strong>Ki·ªÉm tra EKS deployment</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra deployment m·ªõi</span>
</span></span><span style="display:flex;"><span>kubectl get deployments -n retail-forecast-prod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra pods</span>
</span></span><span style="display:flex;"><span>kubectl get pods -n retail-forecast-prod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra image ƒë∆∞·ª£c s·ª≠ d·ª•ng</span>
</span></span><span style="display:flex;"><span>kubectl describe deployment retail-forecast-api -n retail-forecast-prod | grep Image:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra history rollout</span>
</span></span><span style="display:flex;"><span>kubectl rollout history deployment/retail-forecast-api -n retail-forecast-prod
</span></span></code></pre></div></li>
<li>
<p><strong>Test API endpoint</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># L·∫•y endpoint URL</span>
</span></span><span style="display:flex;"><span>ENDPOINT<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get ingress -n retail-forecast-prod retail-forecast-ingress -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.status.loadBalancer.ingress[0].hostname}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra health endpoint</span>
</span></span><span style="display:flex;"><span>curl -v http://$ENDPOINT/health
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Test prediction endpoint</span>
</span></span><span style="display:flex;"><span>curl -X POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{&#34;store_id&#34;: 1, &#34;item_id&#34;: 123, &#34;date&#34;: &#34;2023-12-01&#34;}&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  http://$ENDPOINT/predict
</span></span></code></pre></div></li>
</ol>
<h3 id="63-monitoring-commands">6.3 Monitoring Commands</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra CloudWatch metrics c·ªßa API</span>
</span></span><span style="display:flex;"><span>aws cloudwatch get-metric-statistics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --namespace <span style="color:#e6db74">&#34;RetailForecast/prod&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --metric-name <span style="color:#e6db74">&#34;Latency&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dimensions Name<span style="color:#f92672">=</span>DeploymentId,Value<span style="color:#f92672">=</span>&lt;latest-deployment-id&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --start-time <span style="color:#66d9ef">$(</span>date -u -d <span style="color:#e6db74">&#39;1 hour ago&#39;</span> +%Y-%m-%dT%H:%M:%SZ<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --end-time <span style="color:#66d9ef">$(</span>date -u +%Y-%m-%dT%H:%M:%SZ<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --period <span style="color:#ae81ff">60</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --statistics Average
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra SageMaker endpoint metrics</span>
</span></span><span style="display:flex;"><span>aws cloudwatch get-metric-statistics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --namespace <span style="color:#e6db74">&#34;AWS/SageMaker&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --metric-name <span style="color:#e6db74">&#34;ModelLatency&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dimensions Name<span style="color:#f92672">=</span>EndpointName,Value<span style="color:#f92672">=</span>retail-forecast-prod <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --start-time <span style="color:#66d9ef">$(</span>date -u -d <span style="color:#e6db74">&#39;1 hour ago&#39;</span> +%Y-%m-%dT%H:%M:%SZ<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --end-time <span style="color:#66d9ef">$(</span>date -u +%Y-%m-%dT%H:%M:%SZ<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --period <span style="color:#ae81ff">60</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --statistics Average
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra Pipeline metrics</span>
</span></span><span style="display:flex;"><span>aws cloudwatch get-metric-statistics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --namespace <span style="color:#e6db74">&#34;RetailForecast/Pipeline&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --metric-name <span style="color:#e6db74">&#34;DeploymentSuccess&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --start-time <span style="color:#66d9ef">$(</span>date -u -d <span style="color:#e6db74">&#39;7 days ago&#39;</span> +%Y-%m-%dT%H:%M:%SZ<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --end-time <span style="color:#66d9ef">$(</span>date -u +%Y-%m-%dT%H:%M:%SZ<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --period <span style="color:#ae81ff">86400</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --statistics Sum
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ki·ªÉm tra CloudWatch Logs cho pipeline</span>
</span></span><span style="display:flex;"><span>aws logs get-log-events <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --log-group-name <span style="color:#e6db74">&#34;/aws/sagemaker/TrainingJobs&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --log-stream-name &lt;latest-training-job-name&gt;
</span></span></code></pre></div><h2 id="7-best-practices--t·ªëi-∆∞u">7. Best Practices &amp; T·ªëi ∆∞u</h2>
<h3 id="71-pipeline-optimization">7.1 Pipeline Optimization</h3>
<ul>
<li><strong>Parallel Execution</strong>: Ch·∫°y song song c√°c job kh√¥ng ph·ª• thu·ªôc nhau</li>
<li><strong>Caching</strong>: S·ª≠ d·ª•ng caching cho pip v√† Docker layers</li>
<li><strong>Conditional Execution</strong>: Ch·ªâ ch·∫°y c√°c job c·∫ßn thi·∫øt d·ª±a tr√™n lo·∫°i thay ƒë·ªïi</li>
<li><strong>Matrix Builds</strong>: Test tr√™n nhi·ªÅu phi√™n b·∫£n Python ho·∫∑c m√¥i tr∆∞·ªùng</li>
<li><strong>Artifact Sharing</strong>: S·ª≠ d·ª•ng artifacts ƒë·ªÉ chia s·∫ª d·ªØ li·ªáu gi·ªØa c√°c job</li>
</ul>
<h3 id="72-security-best-practices">7.2 Security Best Practices</h3>
<ul>
<li><strong>OIDC Integration</strong>: S·ª≠ d·ª•ng federation thay v√¨ access keys</li>
<li><strong>Least Privilege IAM</strong>: Role v·ªõi quy·ªÅn h·∫°n t·ªëi thi·ªÉu c·∫ßn thi·∫øt</li>
<li><strong>Secret Management</strong>: S·ª≠ d·ª•ng GitHub Secrets ho·∫∑c AWS Secrets Manager</li>
<li><strong>Image Scanning</strong>: Ki·ªÉm tra l·ªói b·∫£o m·∫≠t trong container images</li>
<li><strong>Network Security</strong>: Gi·ªõi h·∫°n network access trong pipeline</li>
</ul>
<h3 id="73-quality-gates">7.3 Quality Gates</h3>
<ul>
<li><strong>Code Quality Checks</strong>: Linting, formatting, static analysis</li>
<li><strong>Unit &amp; Integration Tests</strong>: Test t·ª± ƒë·ªông cho m·ªçi thay ƒë·ªïi code</li>
<li><strong>Data Validation</strong>: Ki·ªÉm tra t√≠nh to√†n v·∫πn v√† ch·∫•t l∆∞·ª£ng d·ªØ li·ªáu</li>
<li><strong>Model Evaluation</strong>: ƒê√°nh gi√° hi·ªáu su·∫•t model v·ªõi baseline metrics</li>
<li><strong>Performance Testing</strong>: Ki·ªÉm tra ƒë·ªô tr·ªÖ v√† kh·∫£ nƒÉng x·ª≠ l√Ω t·∫£i c·ªßa API</li>
</ul>
<h3 id="74-observability">7.4 Observability</h3>
<ul>
<li><strong>Pipeline Metrics</strong>: Theo d√µi t·∫ßn su·∫•t deployment, th·ªùi gian th·ª±c hi·ªán</li>
<li><strong>Model Monitoring</strong>: Theo d√µi model drift v√† data drift</li>
<li><strong>API Metrics</strong>: Latency, error rate, throughput c·ªßa endpoints</li>
<li><strong>Logging</strong>: Log t·∫≠p trung v·ªõi c·∫•u tr√∫c th·ªëng nh·∫•t</li>
<li><strong>Alerting</strong>: C·∫£nh b√°o s·ªõm khi ph√°t hi·ªán v·∫•n ƒë·ªÅ</li>
</ul>
<h2 id="summary">Summary</h2>
<p>The CI/CD pipeline has been fully implemented using GitHub Actions to automate the MLOps workflow for the Retail Prediction project:</p>
<ol>
<li><strong>Continuous Integration (CI)</strong>: Automatically run tests, linting, and build Docker images.</li>
<li><strong>Automated Training</strong>: Trigger SageMaker training jobs when needed.</li>
<li><strong>Model Registry</strong>: Evaluate models and register versions in the Model Registry.</li>
<li><strong>Continuous Delivery (CD)</strong>: Automatically deploy to the EKS cluster.</li>
<li><strong>Monitoring</strong>: CloudWatch metrics and alerts across the system.</li>
</ol>
<p>This pipeline ensures a reliable, automated, and scalable MLOps process, allowing the team to focus on improving models and features instead of manual operational tasks.</p>

<div class="notices success" ><p><strong>üéØ Task 11 Complete - CI/CD Pipeline</strong></p>
<ul>
<li><strong>GitHub Actions workflow</strong> configured with full CI/CD stages</li>
<li><strong>IAM Role &amp; OIDC</strong> setup for secure authentication</li>
<li><strong>Automated testing</strong> and quality gates</li>
<li><strong>SageMaker integration</strong> for model training &amp; registry</li>
<li><strong>EKS deployment</strong> automation with health checks</li>
<li><strong>CloudWatch monitoring</strong> and notifications</li>
</ul>
</div>

<h2 id="8-clean-up-cicd-resources">8. Clean Up CI/CD Resources</h2>
<h3 id="81-x√≥a-github-actions-workflow">8.1 X√≥a GitHub Actions Workflow</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Disable GitHub Actions workflows</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Th·ª±c hi·ªán tr·ª±c ti·∫øp tr√™n GitHub repository ho·∫∑c qua GitHub CLI</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># N·∫øu s·ª≠ d·ª•ng GitHub CLI</span>
</span></span><span style="display:flex;"><span>gh workflow disable mlops-pipeline.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># List t·∫•t c·∫£ workflow runs</span>
</span></span><span style="display:flex;"><span>gh run list --limit <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Cancel running workflows</span>
</span></span><span style="display:flex;"><span>gh run list --status in_progress --json databaseId --jq <span style="color:#e6db74">&#39;.[].databaseId&#39;</span> | xargs -I <span style="color:#f92672">{}</span> gh run cancel <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a workflow artifacts (c√≥ th·ªÉ t·ªën ph√≠ storage)</span>
</span></span><span style="display:flex;"><span>gh api repos/:owner/:repo/actions/artifacts --paginate | jq -r <span style="color:#e6db74">&#39;.artifacts[] | select(.expired == false) | .id&#39;</span> | xargs -I <span style="color:#f92672">{}</span> gh api --method DELETE repos/:owner/:repo/actions/artifacts/<span style="color:#f92672">{}</span>
</span></span></code></pre></div><h3 id="82-x√≥a-iam-roles-v√†-policies">8.2 X√≥a IAM Roles v√† Policies</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># List t·∫•t c·∫£ IAM roles li√™n quan ƒë·∫øn CI/CD</span>
</span></span><span style="display:flex;"><span>aws iam list-roles <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Roles[?contains(RoleName, `GitHub`) || contains(RoleName, `CICD`) || contains(RoleName, `RetailForecast`)].RoleName&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output table
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Detach policies tr∆∞·ªõc khi x√≥a role</span>
</span></span><span style="display:flex;"><span>aws iam list-attached-role-policies <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name GitHubActionsRole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;AttachedPolicies[].PolicyArn&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read policy_arn; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Detaching policy: </span>$policy_arn<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    aws iam detach-role-policy --role-name GitHubActionsRole --policy-arn <span style="color:#e6db74">&#34;</span>$policy_arn<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a custom policies</span>
</span></span><span style="display:flex;"><span>aws iam delete-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::<span style="color:#66d9ef">$(</span>aws sts get-caller-identity --query Account --output text<span style="color:#66d9ef">)</span>:policy/GitHubActionsPolicy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam delete-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::<span style="color:#66d9ef">$(</span>aws sts get-caller-identity --query Account --output text<span style="color:#66d9ef">)</span>:policy/RetailForecastCICDPolicy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a roles</span>
</span></span><span style="display:flex;"><span>aws iam delete-role --role-name GitHubActionsRole
</span></span><span style="display:flex;"><span>aws iam delete-role --role-name RetailForecastCICDRole
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a instance profiles (n·∫øu c√≥)</span>
</span></span><span style="display:flex;"><span>aws iam remove-role-from-instance-profile <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --instance-profile-name JenkinsInstanceProfile <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name JenkinsRole <span style="color:#f92672">||</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam delete-instance-profile <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --instance-profile-name JenkinsInstanceProfile <span style="color:#f92672">||</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam delete-role --role-name JenkinsRole <span style="color:#f92672">||</span> true
</span></span></code></pre></div><h3 id="83-x√≥a-jenkins-infrastructure-n·∫øu-s·ª≠-d·ª•ng">8.3 X√≥a Jenkins Infrastructure (n·∫øu s·ª≠ d·ª•ng)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminate Jenkins EC2 instances</span>
</span></span><span style="display:flex;"><span>aws ec2 describe-instances <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --filters <span style="color:#e6db74">&#34;Name=tag:Name,Values=Jenkins-Server&#34;</span> <span style="color:#e6db74">&#34;Name=instance-state-name,Values=running&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Reservations[].Instances[].InstanceId&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read instance_id; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Terminating Jenkins instance: </span>$instance_id<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    aws ec2 terminate-instances --instance-ids <span style="color:#e6db74">&#34;</span>$instance_id<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a Jenkins security group</span>
</span></span><span style="display:flex;"><span>JENKINS_SG_ID<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws ec2 describe-security-groups <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --filters <span style="color:#e6db74">&#34;Name=group-name,Values=sg-jenkins&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;SecurityGroups[0].GroupId&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$JENKINS_SG_ID<span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;None&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    aws ec2 delete-security-group --group-id <span style="color:#e6db74">&#34;</span>$JENKINS_SG_ID<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a Jenkins key pair</span>
</span></span><span style="display:flex;"><span>aws ec2 delete-key-pair --key-name jenkins-key-pair <span style="color:#f92672">||</span> true
</span></span></code></pre></div><h3 id="84-x√≥a-sns-topics-v√†-subscriptions">8.4 X√≥a SNS Topics v√† Subscriptions</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># List t·∫•t c·∫£ SNS topics li√™n quan</span>
</span></span><span style="display:flex;"><span>aws sns list-topics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Topics[?contains(TopicArn, `retail-forecast`) || contains(TopicArn, `mlops`)].TopicArn&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output table
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a subscriptions tr∆∞·ªõc</span>
</span></span><span style="display:flex;"><span>SNS_TOPIC_ARN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws sns list-topics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Topics[?contains(TopicArn, `retail-forecast-alerts`)].TopicArn&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$SNS_TOPIC_ARN<span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># List v√† x√≥a subscriptions</span>
</span></span><span style="display:flex;"><span>    aws sns list-subscriptions-by-topic <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --topic-arn <span style="color:#e6db74">&#34;</span>$SNS_TOPIC_ARN<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --query <span style="color:#e6db74">&#39;Subscriptions[].SubscriptionArn&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read sub_arn; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$sub_arn<span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;PendingConfirmation&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>            echo <span style="color:#e6db74">&#34;Unsubscribing: </span>$sub_arn<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            aws sns unsubscribe --subscription-arn <span style="color:#e6db74">&#34;</span>$sub_arn<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># X√≥a topic</span>
</span></span><span style="display:flex;"><span>    aws sns delete-topic --topic-arn <span style="color:#e6db74">&#34;</span>$SNS_TOPIC_ARN<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div><h3 id="85-x√≥a-cloudwatch-resources-cho-cicd">8.5 X√≥a CloudWatch Resources cho CI/CD</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># X√≥a CloudWatch dashboard cho CI/CD</span>
</span></span><span style="display:flex;"><span>aws cloudwatch delete-dashboards <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dashboard-names <span style="color:#e6db74">&#34;RetailForecast-CI-CD-Pipeline&#34;</span> <span style="color:#f92672">||</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a custom metrics namespace</span>
</span></span><span style="display:flex;"><span>aws cloudwatch list-metrics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --namespace <span style="color:#e6db74">&#34;RetailForecast/Pipeline&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Metrics[].MetricName&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read metric; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Found pipeline metric: </span>$metric<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Note: CloudWatch metrics t·ª± ƒë·ªông expire sau 15 th√°ng</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a alarms li√™n quan ƒë·∫øn CI/CD</span>
</span></span><span style="display:flex;"><span>aws cloudwatch describe-alarms <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --alarm-name-prefix <span style="color:#e6db74">&#34;Pipeline-&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;MetricAlarms[].AlarmName&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read alarm; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Deleting pipeline alarm: </span>$alarm<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    aws cloudwatch delete-alarms --alarm-names <span style="color:#e6db74">&#34;</span>$alarm<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a log groups cho CI/CD</span>
</span></span><span style="display:flex;"><span>aws logs delete-log-group <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --log-group-name <span style="color:#e6db74">&#34;/aws/codebuild/retail-forecast-build&#34;</span> <span style="color:#f92672">||</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws logs delete-log-group <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --log-group-name <span style="color:#e6db74">&#34;/aws/codepipeline/retail-forecast-pipeline&#34;</span> <span style="color:#f92672">||</span> true
</span></span></code></pre></div><h3 id="86-x√≥a-ecr-images-v√†-tags">8.6 X√≥a ECR Images v√† Tags</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># List t·∫•t c·∫£ images trong ECR repository</span>
</span></span><span style="display:flex;"><span>aws ecr describe-images <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --repository-name mlops/retail-api <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --region ap-southeast-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;imageDetails[].imageTags[]&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output table
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a specific CI/CD tags (gi·ªØ l·∫°i production tags)</span>
</span></span><span style="display:flex;"><span>aws ecr batch-delete-image <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --repository-name mlops/retail-api <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --region ap-southeast-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image-ids imageTag<span style="color:#f92672">=</span>dev imageTag<span style="color:#f92672">=</span>staging imageTag<span style="color:#f92672">=</span>feature-* <span style="color:#f92672">||</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a untagged images</span>
</span></span><span style="display:flex;"><span>aws ecr describe-images <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --repository-name mlops/retail-api <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --region ap-southeast-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --filter tagStatus<span style="color:#f92672">=</span>UNTAGGED <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;imageDetails[].imageDigest&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read digest; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Deleting untagged image: </span>$digest<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    aws ecr batch-delete-image <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --repository-name mlops/retail-api <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --region ap-southeast-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --image-ids imageDigest<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$digest<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h3 id="87-clean-up-sagemaker-resources">8.7 Clean Up SageMaker Resources</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># List training jobs created by CI/CD</span>
</span></span><span style="display:flex;"><span>aws sagemaker list-training-jobs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --name-contains <span style="color:#e6db74">&#34;retail-forecast&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-results <span style="color:#ae81ff">50</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;TrainingJobSummaries[].TrainingJobName&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output table
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Stop running training jobs</span>
</span></span><span style="display:flex;"><span>aws sagemaker list-training-jobs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --status-equals InProgress <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --name-contains <span style="color:#e6db74">&#34;retail-forecast&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;TrainingJobSummaries[].TrainingJobName&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read job_name; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Stopping training job: </span>$job_name<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    aws sagemaker stop-training-job --training-job-name <span style="color:#e6db74">&#34;</span>$job_name<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a model versions trong Model Registry (gi·ªØ approved models)</span>
</span></span><span style="display:flex;"><span>aws sagemaker list-model-packages <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --model-package-group-name <span style="color:#e6db74">&#34;retail-forecast-models&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --model-approval-status PendingManualApproval <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;ModelPackageSummaryList[].ModelPackageArn&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read package_arn; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Deleting pending model package: </span>$package_arn<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    aws sagemaker delete-model-package --model-package-name <span style="color:#e6db74">&#34;</span>$package_arn<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># X√≥a endpoints t·ª´ failed deployments</span>
</span></span><span style="display:flex;"><span>aws sagemaker list-endpoints <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --name-contains <span style="color:#e6db74">&#34;retail-forecast-dev&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Endpoints[?EndpointStatus==`Failed`].EndpointName&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text | tr <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#e6db74">&#39;\n&#39;</span> | <span style="color:#66d9ef">while</span> read endpoint; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Deleting failed endpoint: </span>$endpoint<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    aws sagemaker delete-endpoint --endpoint-name <span style="color:#e6db74">&#34;</span>$endpoint<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h3 id="88-verification">8.8 Verification</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Verify IAM resources ƒë√£ b·ªã x√≥a</span>
</span></span><span style="display:flex;"><span>aws iam get-role --role-name GitHubActionsRole 2&gt;/dev/null <span style="color:#f92672">||</span> echo <span style="color:#e6db74">&#34;GitHubActionsRole deleted&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verify SNS topics ƒë√£ b·ªã x√≥a</span>
</span></span><span style="display:flex;"><span>aws sns list-topics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Topics[?contains(TopicArn, `retail-forecast-alerts`)]&#39;</span> <span style="color:#f92672">||</span> echo <span style="color:#e6db74">&#34;SNS topics cleaned&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verify CloudWatch resources</span>
</span></span><span style="display:flex;"><span>aws cloudwatch describe-dashboards <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dashboard-name-prefix <span style="color:#e6db74">&#34;RetailForecast-CI-CD&#34;</span> <span style="color:#f92672">||</span> echo <span style="color:#e6db74">&#34;Dashboards cleaned&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verify no running training jobs</span>
</span></span><span style="display:flex;"><span>aws sagemaker list-training-jobs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --status-equals InProgress <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --name-contains <span style="color:#e6db74">&#34;retail-forecast&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;TrainingJobSummaries&#39;</span> <span style="color:#f92672">||</span> echo <span style="color:#e6db74">&#34;No running training jobs&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check GitHub Actions status</span>
</span></span><span style="display:flex;"><span>gh run list --limit <span style="color:#ae81ff">5</span> --status completed
</span></span></code></pre></div><h2 id="9-b·∫£ng-gi√°-cicd-pipeline-ap-southeast-1">9. B·∫£ng gi√° CI/CD Pipeline (ap-southeast-1)</h2>
<h3 id="91-github-actions-pricing">9.1. GitHub Actions Pricing</h3>
<table>
  <thead>
      <tr>
          <th>Plan</th>
          <th>Included Minutes</th>
          <th>Price per minute</th>
          <th>Storage</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Free (Public repos)</strong></td>
          <td>Unlimited</td>
          <td>$0</td>
          <td>500MB</td>
      </tr>
      <tr>
          <td><strong>Free (Private repos)</strong></td>
          <td>2,000 min/month</td>
          <td>$0.008</td>
          <td>500MB</td>
      </tr>
      <tr>
          <td><strong>Pro</strong></td>
          <td>3,000 min/month</td>
          <td>$0.008</td>
          <td>1GB</td>
      </tr>
      <tr>
          <td><strong>Team</strong></td>
          <td>10,000 min/month</td>
          <td>$0.008</td>
          <td>2GB</td>
      </tr>
      <tr>
          <td><strong>Enterprise</strong></td>
          <td>50,000 min/month</td>
          <td>$0.008</td>
          <td>50GB</td>
      </tr>
  </tbody>
</table>
<p><strong>Runner costs:</strong></p>
<ul>
<li>Ubuntu: Standard rate</li>
<li>macOS: 10x Standard rate</li>
<li>Windows: 2x Standard rate</li>
<li>Self-hosted: Free compute, infrastructure cost only</li>
</ul>
<h3 id="92-aws-iam-v√†-security-costs">9.2. AWS IAM v√† Security Costs</h3>
<table>
  <thead>
      <tr>
          <th>Service</th>
          <th>Cost</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>IAM Roles &amp; Policies</strong></td>
          <td>Free</td>
          <td>Unlimited roles and policies</td>
      </tr>
      <tr>
          <td><strong>STS AssumeRole calls</strong></td>
          <td>$0.002/1000 calls</td>
          <td>OIDC authentication</td>
      </tr>
      <tr>
          <td><strong>AWS Config (compliance)</strong></td>
          <td>$0.003/configuration item</td>
          <td>Policy compliance tracking</td>
      </tr>
  </tbody>
</table>
<p><strong>Example calculation:</strong></p>
<ul>
<li>100 CI/CD runs/month √ó 5 STS calls = 500 calls = $0.001/month</li>
</ul>
<h3 id="93-sagemaker-training-costs-trong-cicd">9.3. SageMaker Training Costs trong CI/CD</h3>
<table>
  <thead>
      <tr>
          <th>Instance Type</th>
          <th>Cost per Hour</th>
          <th>Typical Job Duration</th>
          <th>Cost per Run</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>ml.m5.large</strong></td>
          <td>$0.134</td>
          <td>15 minutes</td>
          <td>$0.034</td>
      </tr>
      <tr>
          <td><strong>ml.m5.xlarge</strong></td>
          <td>$0.269</td>
          <td>10 minutes</td>
          <td>$0.045</td>
      </tr>
      <tr>
          <td><strong>ml.c5.xlarge</strong></td>
          <td>$0.238</td>
          <td>8 minutes</td>
          <td>$0.032</td>
      </tr>
      <tr>
          <td><strong>ml.p3.2xlarge</strong></td>
          <td>$4.284</td>
          <td>5 minutes</td>
          <td>$0.357</td>
      </tr>
  </tbody>
</table>
<p><strong>Monthly costs by frequency:</strong></p>
<ul>
<li>Daily training: 30 runs √ó $0.045 = $1.35</li>
<li>Weekly training: 4 runs √ó $0.045 = $0.18</li>
<li>On-demand training: 2 runs √ó $0.045 = $0.09</li>
</ul>
<h3 id="94-ecr-storage-v√†-transfer-costs">9.4. ECR Storage v√† Transfer Costs</h3>
<table>
  <thead>
      <tr>
          <th>Component</th>
          <th>Cost</th>
          <th>Volume</th>
          <th>Monthly Cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Storage</strong></td>
          <td>$0.10/GB/month</td>
          <td>5GB images</td>
          <td>$0.50</td>
      </tr>
      <tr>
          <td><strong>Data Transfer IN</strong></td>
          <td>Free</td>
          <td>Upload images</td>
          <td>$0</td>
      </tr>
      <tr>
          <td><strong>Data Transfer OUT</strong></td>
          <td>$0.12/GB</td>
          <td>Download to EKS</td>
          <td>Variable</td>
      </tr>
  </tbody>
</table>
<p><strong>Image management costs:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Example: 10 images √ó 500MB each = 5GB storage</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Monthly cost: 5GB √ó $0.10 = $0.50</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Transfer to EKS: 5GB √ó $0.12 = $0.60 (one-time per deployment)</span>
</span></span></code></pre></div><h3 id="95-cloudwatch-monitoring-cho-cicd">9.5. CloudWatch Monitoring cho CI/CD</h3>
<table>
  <thead>
      <tr>
          <th>Metric Type</th>
          <th>Quantity</th>
          <th>Unit Cost</th>
          <th>Monthly Cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Custom Metrics</strong></td>
          <td>20 metrics</td>
          <td>$0.30/metric</td>
          <td>$6.00</td>
      </tr>
      <tr>
          <td><strong>API Calls</strong></td>
          <td>100K calls</td>
          <td>$0.01/1K calls</td>
          <td>$1.00</td>
      </tr>
      <tr>
          <td><strong>Alarms</strong></td>
          <td>10 alarms</td>
          <td>$0.10/alarm</td>
          <td>$1.00</td>
      </tr>
      <tr>
          <td><strong>Dashboard</strong></td>
          <td>1 dashboard</td>
          <td>$3.00/dashboard</td>
          <td>$3.00</td>
      </tr>
      <tr>
          <td><strong>Total Monitoring</strong></td>
          <td></td>
          <td></td>
          <td><strong>$11.00</strong></td>
      </tr>
  </tbody>
</table>
<h3 id="96-sns-notification-costs">9.6. SNS Notification Costs</h3>
<table>
  <thead>
      <tr>
          <th>Notification Type</th>
          <th>Volume</th>
          <th>Cost per Message</th>
          <th>Monthly Cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Email</strong></td>
          <td>200 notifications</td>
          <td>$0.75/million</td>
          <td>$0.0002</td>
      </tr>
      <tr>
          <td><strong>SMS</strong></td>
          <td>50 notifications</td>
          <td>$0.8/message</td>
          <td>$40.00</td>
      </tr>
      <tr>
          <td><strong>Slack Webhook</strong></td>
          <td>200 notifications</td>
          <td>$0.75/million</td>
          <td>$0.0002</td>
      </tr>
      <tr>
          <td><strong>Push Mobile</strong></td>
          <td>100 notifications</td>
          <td>$0.75/million</td>
          <td>$0.0001</td>
      </tr>
  </tbody>
</table>
<h3 id="97-jenkins-infrastructure-costs-n·∫øu-self-hosted">9.7. Jenkins Infrastructure Costs (n·∫øu self-hosted)</h3>
<table>
  <thead>
      <tr>
          <th>Component</th>
          <th>Instance Type</th>
          <th>Monthly Hours</th>
          <th>Monthly Cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Jenkins Master</strong></td>
          <td>t3.medium</td>
          <td>730 hours</td>
          <td>$30.37</td>
      </tr>
      <tr>
          <td><strong>Build Agents</strong></td>
          <td>t3.large (2 agents)</td>
          <td>100 hours</td>
          <td>$13.25</td>
      </tr>
      <tr>
          <td><strong>EBS Storage</strong></td>
          <td>100GB gp3</td>
          <td>-</td>
          <td>$8.00</td>
      </tr>
      <tr>
          <td><strong>Data Transfer</strong></td>
          <td>50GB/month</td>
          <td>$0.12/GB</td>
          <td>$6.00</td>
      </tr>
      <tr>
          <td><strong>Total Jenkins</strong></td>
          <td></td>
          <td></td>
          <td><strong>$57.62</strong></td>
      </tr>
  </tbody>
</table>
<h3 id="98-cicd-pipeline-scenarios">9.8. CI/CD Pipeline Scenarios</h3>
<p><strong>Scenario 1: Small Team (GitHub Actions)</strong></p>
<table>
  <thead>
      <tr>
          <th>Component</th>
          <th>Usage</th>
          <th>Monthly Cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>GitHub Actions (private)</td>
          <td>2,000 min included</td>
          <td>$0</td>
      </tr>
      <tr>
          <td>SageMaker training</td>
          <td>4 runs/month</td>
          <td>$0.18</td>
      </tr>
      <tr>
          <td>ECR storage</td>
          <td>2GB images</td>
          <td>$0.20</td>
      </tr>
      <tr>
          <td>CloudWatch basic</td>
          <td>5 metrics, 3 alarms</td>
          <td>$1.80</td>
      </tr>
      <tr>
          <td>SNS notifications</td>
          <td>Email only</td>
          <td>$0.0002</td>
      </tr>
      <tr>
          <td><strong>Total Small Team</strong></td>
          <td></td>
          <td><strong>$2.18/month</strong></td>
      </tr>
  </tbody>
</table>
<p><strong>Scenario 2: Medium Team (GitHub Actions Pro)</strong></p>
<table>
  <thead>
      <tr>
          <th>Component</th>
          <th>Usage</th>
          <th>Monthly Cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>GitHub Actions Pro</td>
          <td>3,000 min + 500 extra</td>
          <td>$4.00</td>
      </tr>
      <tr>
          <td>SageMaker training</td>
          <td>12 runs/month</td>
          <td>$0.54</td>
      </tr>
      <tr>
          <td>ECR storage</td>
          <td>8GB images</td>
          <td>$0.80</td>
      </tr>
      <tr>
          <td>CloudWatch full</td>
          <td>15 metrics, 8 alarms</td>
          <td>$5.30</td>
      </tr>
      <tr>
          <td>SNS notifications</td>
          <td>Email + Slack</td>
          <td>$0.0004</td>
      </tr>
      <tr>
          <td><strong>Total Medium Team</strong></td>
          <td></td>
          <td><strong>$10.64/month</strong></td>
      </tr>
  </tbody>
</table>
<p><strong>Scenario 3: Enterprise (Self-hosted Jenkins)</strong></p>
<table>
  <thead>
      <tr>
          <th>Component</th>
          <th>Usage</th>
          <th>Monthly Cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Jenkins infrastructure</td>
          <td>t3.medium + agents</td>
          <td>$57.62</td>
      </tr>
      <tr>
          <td>SageMaker training</td>
          <td>60 runs/month</td>
          <td>$2.70</td>
      </tr>
      <tr>
          <td>ECR storage</td>
          <td>20GB images</td>
          <td>$2.00</td>
      </tr>
      <tr>
          <td>CloudWatch enterprise</td>
          <td>50 metrics, 25 alarms</td>
          <td>$17.50</td>
      </tr>
      <tr>
          <td>SNS notifications</td>
          <td>Multi-channel</td>
          <td>$40.50</td>
      </tr>
      <tr>
          <td><strong>Total Enterprise</strong></td>
          <td></td>
          <td><strong>$120.32/month</strong></td>
      </tr>
  </tbody>
</table>
<h3 id="99-cost-optimization-strategies">9.9. Cost Optimization Strategies</h3>
<p><strong>GitHub Actions Optimization:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Use matrix strategy ƒë·ªÉ gi·∫£m runtime</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">matrix</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">python-version</span>: [<span style="color:#ae81ff">3.8</span>, <span style="color:#ae81ff">3.9</span>, <span style="color:#ae81ff">3.10</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Cache dependencies</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/cache@v3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">~/.cache/pip</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">key</span>: <span style="color:#ae81ff">${{ runner.os }}-pip-${{ hashFiles(&#39;**/requirements.txt&#39;) }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Conditional jobs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">if</span>: <span style="color:#ae81ff">github.ref == &#39;refs/heads/main&#39;</span>
</span></span></code></pre></div><p><strong>SageMaker Training Optimization:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># S·ª≠ d·ª•ng Spot instances cho training</span>
</span></span><span style="display:flex;"><span>training_params <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;TrainingJobName&#39;</span>: job_name,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ResourceConfig&#39;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;InstanceType&#39;</span>: <span style="color:#e6db74">&#39;ml.m5.large&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;InstanceCount&#39;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;VolumeSizeInGB&#39;</span>: <span style="color:#ae81ff">30</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;UseSpotInstances&#39;</span>: <span style="color:#66d9ef">True</span>,  <span style="color:#75715e"># 90% cost savings</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;MaxRuntimeInSeconds&#39;</span>: <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>ECR Cost Optimization:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Lifecycle policy ƒë·ªÉ t·ª± ƒë·ªông x√≥a old images</span>
</span></span><span style="display:flex;"><span>aws ecr put-lifecycle-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --repository-name mlops/retail-api <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --lifecycle-policy-text <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;rules&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;rulePriority&#34;: 1,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;selection&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;tagStatus&#34;: &#34;untagged&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;countType&#34;: &#34;sinceImagePushed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;countUnit&#34;: &#34;days&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;countNumber&#34;: 7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;action&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;type&#34;: &#34;expire&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#39;</span>
</span></span></code></pre></div><h3 id="910-roi-analysis-cho-cicd-investment">9.10. ROI Analysis cho CI/CD Investment</h3>
<table>
  <thead>
      <tr>
          <th>Benefit</th>
          <th>Manual Process</th>
          <th>Automated CI/CD</th>
          <th>Time Saved</th>
          <th>Cost Benefit</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Code Testing</strong></td>
          <td>2 hours/week</td>
          <td>5 minutes</td>
          <td>1.9 hours</td>
          <td>$95/week</td>
      </tr>
      <tr>
          <td><strong>Model Training</strong></td>
          <td>30 min setup</td>
          <td>Automatic</td>
          <td>2 hours/month</td>
          <td>$100/month</td>
      </tr>
      <tr>
          <td><strong>Deployment</strong></td>
          <td>1 hour/deploy</td>
          <td>5 minutes</td>
          <td>55 min/deploy</td>
          <td>$45/deploy</td>
      </tr>
      <tr>
          <td><strong>Rollback</strong></td>
          <td>2 hours</td>
          <td>5 minutes</td>
          <td>1.9 hours</td>
          <td>$95/incident</td>
      </tr>
  </tbody>
</table>
<p><strong>Annual ROI calculation:</strong></p>
<ul>
<li><strong>Investment:</strong> $127.68/month √ó 12 = $1,532</li>
<li><strong>Savings:</strong> (2 hours/week √ó 52 weeks + 2 hours/month √ó 12) √ó $50/hour = $6,400</li>
<li><strong>ROI:</strong> 322% return on investment</li>
</ul>
<h3 id="911-monitoring-cicd-costs">9.11. Monitoring CI/CD Costs</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Track GitHub Actions usage</span>
</span></span><span style="display:flex;"><span>gh api /repos/:owner/:repo/actions/billing/usage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Monitor SageMaker training costs</span>
</span></span><span style="display:flex;"><span>aws ce get-cost-and-usage <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --time-period Start<span style="color:#f92672">=</span>2024-01-01,End<span style="color:#f92672">=</span>2024-01-31 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --granularity MONTHLY <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --metrics BlendedCost <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-by Type<span style="color:#f92672">=</span>DIMENSION,Key<span style="color:#f92672">=</span>SERVICE <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --filter <span style="color:#e6db74">&#39;{&#34;Dimensions&#34;:{&#34;Key&#34;:&#34;SERVICE&#34;,&#34;Values&#34;:[&#34;Amazon SageMaker&#34;]}}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ECR storage costs</span>
</span></span><span style="display:flex;"><span>aws ecr describe-registry-statistics --region ap-southeast-1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CloudWatch costs</span>
</span></span><span style="display:flex;"><span>aws ce get-cost-and-usage <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --time-period Start<span style="color:#f92672">=</span>2024-01-01,End<span style="color:#f92672">=</span>2024-01-31 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --granularity MONTHLY <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --metrics BlendedCost <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-by Type<span style="color:#f92672">=</span>DIMENSION,Key<span style="color:#f92672">=</span>SERVICE <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --filter <span style="color:#e6db74">&#39;{&#34;Dimensions&#34;:{&#34;Key&#34;:&#34;SERVICE&#34;,&#34;Values&#34;:[&#34;Amazon CloudWatch&#34;]}}&#39;</span>
</span></span></code></pre></div>
<div class="notices info" ><p><strong>üí∞ Cost Summary cho Task 11:</strong></p>
<ul>
<li><strong>Small Team (GitHub Free):</strong> $2.18/month</li>
<li><strong>Medium Team (GitHub Pro):</strong> $10.64/month</li>
<li><strong>Enterprise (Self-hosted):</strong> $120.32/month</li>
<li><strong>ROI:</strong> 322% v·ªõi automation benefits</li>
<li><strong>Break-even point:</strong> ~3 months cho medium team setup</li>
</ul>
</div>

<hr>
<p><strong>Next Step</strong>: <a href="/5-workshop/12-cost--teardown/">Task 12: Cost Optimization &amp; Teardown</a></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/5-workshop/10-cloudwatch/" title="CloudWatch Monitoring"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/5-workshop/12-cost--teardown/" title="Cost Management &amp; Teardown" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1765385196"></script>
    <script src="/js/perfect-scrollbar.min.js?1765385196"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1765385196"></script>
    <script src="/js/jquery.sticky.js?1765385196"></script>
    <script src="/js/featherlight.min.js?1765385196"></script>
    <script src="/js/highlight.pack.js?1765385196"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1765385196"></script>
    <script src="/js/learn.js?1765385196"></script>
    <script src="/js/hugo-learn.js?1765385196"></script>

    <link href="/mermaid/mermaid.css?1765385196" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1765385196"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
